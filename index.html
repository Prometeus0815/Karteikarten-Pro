<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karteikarten-Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles for the flip card animation and other UI enhancements */
        .flip-card {
            perspective: 1000px; /* Provides the 3D perspective for the flip effect */
        }
        .flip-card-inner {
            position: relative; /* Needed for absolute positioning of front/back */
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s; /* Smooth transition for the flip */
            transform-style: preserve-3d; /* Ensures children are treated in 3D space */
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg); /* Flips the card 180 degrees on the Y-axis */
        }
        .flip-card-front, .flip-card-back {
            position: absolute; /* Allows front and back to occupy the same space */
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Hides the back of the element when facing away (for Safari) */
            backface-visibility: hidden; /* Hides the back of the element when facing away */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem; /* .rounded-xl */
        }
        .flip-card-back {
            transform: rotateY(180deg); /* Initially positions the back side as flipped */
        }
        .progress-bar {
            transition: width 0.3s ease; /* Smooth transition for progress bar width changes */
        }
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .sidebar-item:hover {
            background-color: rgba(99, 102, 241, 0.1); /* Subtle hover effect for sidebar items */
        }
        .sidebar-item.active {
            background-color: rgba(99, 102, 241, 0.2); /* Style for the active/selected sidebar item */
            border-left: 3px solid rgb(99, 102, 241);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); /* Consistent gradient background */
        }
        .card-hover:hover {
            transform: translateY(-2px); /* Slight lift effect on card hover */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* Enhanced shadow on hover */
        }
        /* Mobile Sidebar Overlay */
        .sidebar-mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 30; /* Lower than sidebar, higher than main content */
        }
    </style>
</head>
<body class="bg-gray-50 font-sans flex flex-col min-h-screen">
    <div class="flex flex-1 overflow-hidden">
        <div id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 bg-white border-r border-gray-200 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-200 ease-in-out flex flex-col">
            <div class="flex items-center justify-between h-16 px-4 gradient-bg text-white">
                <div class="flex items-center">
                    <i class="fas fa-layer-group text-xl mr-2"></i>
                    <h1 class="text-xl font-bold">Karteikarten-Pro</h1>
                </div>
                <button id="closeSidebarBtn" class="p-2 text-white rounded-md md:hidden hover:bg-indigo-700 focus:outline-none">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="flex flex-col flex-grow overflow-y-auto">
                <div class="px-4 py-4">
                    <button id="createDeckBtn" class="w-full flex items-center justify-center px-4 py-2 text-sm font-medium text-white gradient-bg rounded-md hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                        <i class="fas fa-plus mr-2"></i> Neues Deck
                    </button>
                </div>
                <nav class="flex-1 px-2 space-y-1">
                    <div id="decksList" class="space-y-1">
                        </div>
                </nav>
            </div>
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center">
                    <img class="w-10 h-10 rounded-full" src="https://ui-avatars.com/api/?name=Benutzer&background=6366f1&color=fff" alt="Profilbild" onerror="this.onerror=null; this.src='https://placehold.co/40x40/6366f1/fff?text=B';">
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-900">Benutzer</p>
                        <p class="text-sm font-medium text-gray-500">Profil anzeigen</p>
                    </div>
                </div>
            </div>
        </div>
        <div id="sidebarOverlay" class="sidebar-mobile-overlay hidden md:hidden"></div>


        <div class="flex flex-col flex-1 overflow-hidden">
            <div class="flex items-center justify-between h-16 px-4 bg-white border-b border-gray-200">
                <div class="flex items-center min-w-0"> <button id="sidebarToggle" class="p-2 mr-2 text-gray-500 rounded-md md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200">
                        <i class="fas fa-bars"></i> </button>
                    <button id="backBtn" class="p-2 mr-2 text-gray-500 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 hidden" title="Zurück">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2 id="currentDeckTitle" class="text-lg font-medium text-gray-900 truncate">Willkommen</h2>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <button id="syncBtn" class="p-2 text-gray-500 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" title="Daten synchronisieren">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="statsBtn" class="p-2 text-gray-500 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" title="Statistiken anzeigen">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                </div>
            </div>

            <div id="mainContent" class="flex-1 overflow-auto p-4">
                <div id="welcomeScreen" class="flex flex-col items-center justify-center h-full">
                    <div class="max-w-md p-6 sm:p-8 bg-white rounded-xl shadow-lg text-center">
                        <div class="w-20 h-20 gradient-bg rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-book-open text-3xl text-white"></i>
                        </div>
                        <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-2">Willkommen zu Karteikarten-Pro</h2>
                        <p class="text-gray-600 mb-6 text-sm sm:text-base">Erstelle oder wähle ein Deck aus, um mit dem Lernen zu beginnen.</p>
                        <button id="welcomeCreateDeckBtn" class="px-6 py-3 text-white font-medium rounded-md gradient-bg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                            Neues Deck erstellen
                        </button>
                    </div>
                </div>

                <div id="deckView" class="hidden">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                        <div>
                            <h2 id="deckTitle" class="text-xl sm:text-2xl font-bold text-gray-800"></h2> <p id="deckStats" class="text-sm text-gray-600"></p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full sm:w-auto">
                            <button id="addCardBtn" class="w-full sm:w-auto px-4 py-2 text-white font-medium rounded-md gradient-bg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                <i class="fas fa-plus mr-2"></i>Karte hinzufügen
                            </button>
                            <button id="studyDeckBtn" class="w-full sm:w-auto px-4 py-2 bg-emerald-500 text-white font-medium rounded-md hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                                <i class="fas fa-graduation-cap mr-2"></i>Lernen
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <h3 class="text-md font-semibold text-gray-700 mb-3">Spezielle Übungsmodi:</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2">
                            <button id="studyAgainBtn" class="px-4 py-2 text-sm bg-red-500 text-white font-medium rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all">
                                <i class="fas fa-redo mr-2"></i>Nochmal Üben
                            </button>
                            <button id="studyHardBtn" class="px-4 py-2 text-sm bg-amber-500 text-white font-medium rounded-md hover:bg-amber-600 focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all">
                                <i class="fas fa-fire mr-2"></i>Schwer Üben
                            </button>
                            <button id="studyEasyBtn" class="px-4 py-2 text-sm bg-sky-500 text-white font-medium rounded-md hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-500 transition-all">
                                <i class="fas fa-check-double mr-2"></i>Einfach Üben
                            </button>
                            <button id="studyTestBtn" class="px-4 py-2 text-sm bg-purple-500 text-white font-medium rounded-md hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                                <i class="fas fa-vial mr-2"></i>Testmodus
                            </button>
                        </div>
                    </div>

                    <div id="cardsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-6">
                        </div>
                </div>

                <div id="studyView" class="hidden">
                    <div class="flex flex-col items-center justify-center h-full">
                        <div class="w-full max-w-2xl">
                            <p id="studyModeIndicator" class="text-center text-sm text-gray-600 mb-2"></p>
                            <div class="mb-6">
                                <div class="flex justify-between items-center">
                                    <span id="cardsRemaining" class="text-sm font-medium text-gray-600">0 Karten übrig</span>
                                    <span id="studyProgress" class="text-sm font-medium text-gray-600">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-1">
                                    <div id="progressBar" class="gradient-bg h-2.5 rounded-full progress-bar" style="width: 0%"></div>
                                </div>
                            </div>

                            <div id="cardContainer" class="flip-card w-full h-56 sm:h-64 mb-8">
                                <div class="flip-card-inner w-full h-full">
                                    <div class="flip-card-front bg-blue-100 text-blue-800 p-4 sm:p-6 cursor-pointer card-shadow transition-all">
                                        <p id="cardFront" class="text-lg sm:text-xl text-center">Karte wird geladen...</p>
                                    </div>
                                    <div class="flip-card-back bg-green-100 text-green-800 p-4 sm:p-6 cursor-pointer card-shadow transition-all">
                                        <p id="cardBack" class="text-lg sm:text-xl text-center">Karte wird geladen...</p>
                                    </div>
                                </div>
                            </div>

                            <div id="answerButtons" class="hidden grid grid-cols-1 md:grid-cols-3 gap-2 sm:gap-4">
                                <button data-difficulty="again" class="px-4 py-3 bg-red-500 text-white font-medium rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all">
                                    <i class="fas fa-times mr-2"></i>Nochmal
                                </button>
                                <button data-difficulty="hard" class="px-4 py-3 bg-amber-500 text-white font-medium rounded-md hover:bg-amber-600 focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all">
                                    <i class="fas fa-question mr-2"></i>Schwer
                                </button>
                                <button data-difficulty="easy" class="px-4 py-3 bg-emerald-500 text-white font-medium rounded-md hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all">
                                    <i class="fas fa-check mr-2"></i>Einfach
                                </button>
                            </div>

                            <div id="studyComplete" class="hidden text-center">
                                <div class="bg-white rounded-xl p-6 sm:p-8 shadow-lg">
                                    <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-check-circle text-3xl text-emerald-500"></i>
                                    </div>
                                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-2">Studium abgeschlossen!</h2>
                                    <p class="text-gray-600 mb-6 text-sm sm:text-base">Du hast alle Karten für heute durchgearbeitet.</p>
                                    <button id="returnToDeckBtn" class="px-6 py-3 text-white font-medium rounded-md gradient-bg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                        Zurück zum Deck
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="cardModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-md transform transition-all">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 id="modalTitle" class="text-lg font-medium text-gray-900">Neue Karte</h3>
                        </div>
                        <div class="p-6">
                            <div class="mb-4">
                                <label for="cardFrontInput" class="block text-sm font-medium text-gray-700 mb-1">Vorderseite</label>
                                <textarea id="cardFrontInput" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Frage oder Begriff"></textarea>
                            </div>
                            <div class="mb-4">
                                <label for="cardBackInput" class="block text-sm font-medium text-gray-700 mb-1">Rückseite</label>
                                <textarea id="cardBackInput" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Antwort oder Definition"></textarea>
                            </div>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                            <button id="cancelCardBtn" class="px-4 py-2 text-gray-700 font-medium rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 transition-all">
                                Abbrechen
                            </button>
                            <button id="saveCardBtn" class="px-4 py-2 text-white font-medium rounded-md gradient-bg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                Speichern
                            </button>
                        </div>
                    </div>
                </div>

                <div id="deckModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-md transform transition-all">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">Neues Deck erstellen</h3>
                        </div>
                        <div class="p-6">
                            <div class="mb-4">
                                <label for="deckNameInput" class="block text-sm font-medium text-gray-700 mb-1">Deck Name</label>
                                <input type="text" id="deckNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="z.B. Spanisch Vokabeln">
                            </div>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                            <button id="cancelDeckBtn" class="px-4 py-2 text-gray-700 font-medium rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 transition-all">
                                Abbrechen
                            </button>
                            <button id="saveDeckBtn" class="px-4 py-2 text-white font-medium rounded-md gradient-bg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                Erstellen
                            </button>
                        </div>
                    </div>
                </div>

                <div id="moveCardModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-md transform transition-all">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">Karte verschieben</h3>
                        </div>
                        <div class="p-6">
                            <p class="text-sm text-gray-700 mb-1">Karte (Vorderseite):</p>
                            <p id="moveCardModalFront" class="text-md font-semibold text-gray-800 mb-4 p-3 bg-gray-100 rounded-md break-words"></p>
                            <div class="mb-4">
                                <label for="targetDeckSelect" class="block text-sm font-medium text-gray-700 mb-1">Ziel-Deck auswählen:</label>
                                <select id="targetDeckSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </select>
                            </div>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                            <button id="cancelMoveCardBtn" class="px-4 py-2 text-gray-700 font-medium rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 transition-all">
                                Abbrechen
                            </button>
                            <button id="confirmMoveCardBtn" class="px-4 py-2 text-white font-medium rounded-md gradient-bg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                                Verschieben
                            </button>
                        </div>
                    </div>
                </div>


                <div id="statsView" class="hidden">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Statistiken</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-indigo-50 rounded-xl p-4">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-indigo-100 text-indigo-600 mr-4">
                                        <i class="fas fa-book-open text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-600">Decks</p>
                                        <p id="statsDecksCount" class="text-2xl font-bold text-gray-800">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-emerald-50 rounded-xl p-4">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-emerald-100 text-emerald-600 mr-4">
                                        <i class="fas fa-layer-group text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-600">Karten</p>
                                        <p id="statsCardsCount" class="text-2xl font-bold text-gray-800">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-purple-50 rounded-xl p-4">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
                                        <i class="fas fa-check-circle text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-600">Heute gelernt</p>
                                        <p id="statsStudiedToday" class="text-2xl font-bold text-gray-800">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-8">
                            <h3 class="text-lg font-medium text-gray-800 mb-4">Aktivität (Letzte 7 Tage)</h3>
                            <div class="bg-white border border-gray-200 rounded-xl p-4">
                                <canvas id="activityChart" height="200"></canvas> </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-medium text-gray-800 mb-4">Deck Fortschritt</h3>
                            <div id="deckProgressList" class="space-y-4">
                                </div>
                        </div>
                    </div>
                </div>
            </div> </div> </div> <footer class="bg-gray-100 text-center p-4 text-sm text-gray-600 border-t border-gray-200">
        Entwickelt von Patrick Hernach
    </footer>

    <script>
        // --- PREDEFINED DECKS (INITIAL SAMPLE + NEW CONTENT FROM PDFs) ---
        const predefinedDecks = [
            {
                id: "deck-glossar-gastro-erweitert-01", 
                name: "Gastronomie-Fremdwörter (Glossar)",
                cards: [
                    { id: "gf-card-1", front: "Amuse bouche", back: "Warmer Gruß aus der Küche vor dem Menü.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "gf-card-2", front: "Bain-marie", back: "Wasserbad zum Warmhalten von Speisen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "gf-card-3", front: "Concierge", back: "Hotelmitarbeiter, der Gästen bei besonderen Wünschen hilft (Tickets, Arzttermine, Gepäck etc.).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "gf-card-4", front: "Degorgieren", back: "Entfernen des Hefepfropfens aus der Flasche beim Flaschengärverfahren (z. B. Champagner).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "gf-card-5", front: "Mise en Place", back: "Vorbereitung aller benötigten Zutaten und Werkzeuge am Arbeitsplatz vor dem Kochen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-002", front: "Aprikotieren", back: "Bestreichen (einer Torte) mit heißer Aprikosenmarmelade (im Kontext der Sachertorte).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-003", front: "Back Office", back: "Verwaltungsbereich eines Hotels, zuständig für z. B. Dienstpläne, Verwaltung, Social Media, Angebote.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-004", front: "Bechamel", back: "Eine weiße Grundsauce auf Basis von Milch, Mehlschwitze und Butter.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-005", front: "Bouillon", back: "Rindsuppe, klare Suppe aus Rindfleisch und/oder Knochen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-006", front: "Caprese", back: "Italienischer Vorspeisensalat aus Tomaten, Mozzarella und Basilikum.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-007", front: "Carpaccio", back: "Italienische Vorspeise aus hauchdünn geschnittenem, rohem Rinderfilet.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-010", front: "Consommé", back: "Kraftsuppe, eine durch Klären verfeinerte Bouillon.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-011", front: "Consommé double", back: "Doppelte Kraftsuppe, nochmals mit Klärfleisch angesetzt.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-012", front: "COS (Cost of Sale)", back: "Kosten des Verkaufs.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-013", front: "CRM (Customer-Relationship-Management)", back: "Kundenbeziehungsmanagement.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-015", front: "Cutter", back: "Küchenmaschine zum feinen Zerkleinern/Hacken, z. B. für Fleisch.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-016", front: "DAC (Districtus Austriae Controllatus)", back: "Geschützte Herkunftsbezeichnung für gebietstypische österreichische Qualitätsweine.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-017", front: "Dämpfen", back: "Garmethode mit Wasserdampf, mit oder ohne Druck.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-018", front: "Dosage", back: "Zugabe von Wein und Zucker zur Sektflasche nach dem Degorgieren zur Bestimmung der Süße.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-019", front: "Dünsten", back: "Garmethode in wenig Flüssigkeit bei geschlossenem Deckel.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-020", front: "Einspänner", back: "Wiener Kaffeespezialität: Schwarzer Kaffee (Mokka) im Glas mit Schlagobershaube.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-022", front: "Espagnole", back: "Braune Grundsauce, Basis für viele dunkle Saucen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-023", front: "Farcenockerl", back: "Suppeneinlage aus einer Farce (fein zerkleinerte Masse) für Kraftsuppen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-024", front: "Fiaker", back: "Wiener Kaffeespezialität: Schwarzer Kaffee (Mokka) im Glas mit Rum oder Weinbrand.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-025", front: "Filetieren", back: "Zerlegen von Fisch (Entfernen der Gräten) oder Schälen/Zerteilen von Obst bei Tisch.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-026", front: "Flambieren", back: "Abflämmen einer Speise durch Übergießen mit hochprozentigem Alkohol und Anzünden.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-027", front: "Frittieren", back: "Garmethode durch Schwimmendbacken in heißem Fett.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-028", front: "Front Office", back: "Empfangsbereich eines Hotels (Rezeption).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-030", front: "Garni", back: "Hotelbetrieb, der nur Frühstück anbietet.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-031", front: "Glace", back: "Eis, oder Fleischglace (stark reduzierte Brühe).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-032", front: "Gratinieren", back: "Überbacken mit einer Kruste (Käse, Brösel).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-033", front: "Guéridon", back: "Beistelltisch im Restaurant für Servicearbeiten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-034", front: "Horsd’œuvre", back: "Kalte Vorspeise.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-035", front: "Julienne", back: "In feine Streifen geschnittenes Gemüse.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-036", front: "Jus", back: "Natürlicher Bratensaft, oft ungebunden.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-037", front: "Karkasse", back: "Knochengerüst von Geflügel oder Wild.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-038", front: "Legieren", back: "Binden von Saucen/Suppen mit Eigelb und Sahne.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-039", front: "Louche", back: "Schaumkelle.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-040", front: "Marinieren", back: "Einlegen von Lebensmitteln in eine gewürzte Flüssigkeit.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-041", front: "Melieren", back: "Vorsichtiges Unterheben von Zutaten (z.B. Eischnee).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-042", front: "Mirepoix", back: "Grob gewürfeltes Röstgemüse (Karotten, Sellerie, Zwiebeln).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-043", front: "Nappieren", back: "Überziehen von Speisen mit Sauce.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-044", front: "Parieren", back: "Entfernen von Sehnen, Fett und Haut von Fleisch.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-045", front: "Passieren", back: "Durch ein Sieb oder Tuch streichen, um feste Bestandteile zu entfernen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-047", front: "Pochieren", back: "Garmethode unter dem Siedepunkt in Flüssigkeit oder im Wasserbad.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-050", front: "Ravioli", back: "Italienische gefüllte Teigtaschen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-051", front: "Rechaud", back: "Warmhalteplatte oder Tellerwärmer.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-054", front: "Salamander", back: "Gerät zum Überbacken/Gratinieren mit starker Oberhitze.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-055", front: "Sauce Tartare", back: "Kalte Sauce auf Mayonnaise-Basis mit gehackten Kräutern, Kapern, Essiggurken.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-057", front: "Sautieren", back: "Kurzbraten oder Schwenken von Lebensmitteln in der Pfanne bei hoher Hitze.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-058", front: "Sorbet", back: "Eis aus Fruchtsaft oder -püree, Wasser und Zucker, oft als Zwischengang serviert.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-060", front: "Sous-vide", back: "Garmethode im Vakuumbeutel bei niedrigen, kontrollierten Temperaturen im Wasserbad.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-061", front: "Steamer", back: "Hochdruckschnelldämpfer.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-062", front: "Tatar", back: "Fein gehacktes rohes Fleisch oder Fisch, angemacht (als Beispiel genannt).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-063", front: "Timbales", back: "Schüsseln oder Förmchen (im Kontext des Servierens von Platten genannt).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-065", front: "Tranchieren", back: "Fachgerechtes Zerlegen von gegartem Fleisch oder Geflügel bei Tisch oder in der Küche.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-066", front: "Velouté", back: "Helle Grundsauce, gebunden mit einer hellen Mehlschwitze und aufgegossen mit hellem Fond.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-067", front: "Zesten", back: "Dünn abgeschälte äußere Schale von Zitrusfrüchten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-068", front: "Ziselieren", back: "Einschneiden der Haut von Fisch oder Fleisch vor dem Garen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-069", front: "Sommelier/Sommelière", back: "Weinkellner/in, zuständig für Weinberatung, -auswahl und -service.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-070", front: "Bankett", back: "Festessen, Festmahl für eine größere Anzahl von Personen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-071", front: "Degustation", back: "Verkostung, insbesondere von Wein oder anderen Lebensmitteln.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-072", front: "Canapé", back: "Kleine, belegte Brotscheibe, oft als Vorspeise oder zum Aperitif.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-073", front: "Chafing-Dish", back: "Warmhaltegerät für Speisen am Buffet, oft mit Brennpaste betrieben.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-074", front: "Cloche", back: "Glockenförmige Abdeckhaube zum Warmhalten von Speisen auf dem Teller.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-075", front: "À la minute", back: "Frisch zubereitet, erst nach Bestellung des Gastes.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-076", front: "Amuse-Gueule", back: "Kleine, appetitanregende Häppchen, die vor dem Menü serviert werden (oft kalt).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-077", front: "Brunoise", back: "Sehr fein gewürfeltes Gemüse (ca. 1-2 mm Kantenlänge).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-gg-078", front: "Concasse", back: "Grob gewürfelte, enthäutete und entkernte Tomaten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() }
                ],
                createdAt: new Date().toISOString()
            },
            {
                id: "deck-rechtskunde-erweitert-01",
                name: "Rechtskunde (Detailfragen)",
                cards: [
                    { id: "rk-card-1", front: "Wann ist eine Tätigkeit gewerblich?", back: "Eine Tätigkeit ist gewerblich, wenn sie folgende Merkmale aufweist: Selbstständigkeit (auf eigene Rechnung und Gefahr), Regelmäßigkeit (wiederholte Ausübung), Ertragsabsicht (wirtschaftlicher Vorteil soll erzielt werden), Erlaubtheit (nicht verboten oder sittenwidrig), Organisationsstruktur (in gewerblich eingerichteter Weise).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "rk-card-2", front: "Welche wichtigen Ausnahmen vom Geltungsbereich der Gewerbeordnung kennen Sie?", back: "Ausgenommen sind: Freie Berufe (z. B. Ärzte, Notare, Rechtsanwälte), Urproduktion (z. B. Land- und Forstwirtschaft), Bestimmte Nebentätigkeiten im Rahmen von Vereinen oder Hauswirtschaft.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "rk-card-3", front: "Was wird im Zuge des Betriebsanlagenverfahrens geprüft?", back: "Gesundheits- und Umweltschutz, Brandschutz, Nachbarschaftsverträglichkeit, Einhaltung baurechtlicher Vorschriften.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "rk-card-4", front: "Was versteht man unter Verabreichung und Ausschank?", back: "Verabreichung: Servieren von Speisen. Ausschank: Servieren von Getränken, insbesondere alkoholischer.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "rk-card-5", front: "Was muss ein Dienstzeugnis enthalten?", back: "Dauer und Art der Beschäftigung. Wahrheitsgemäße, wohlwollende Formulierung. Auf Wunsch: auch über Leistung und Verhalten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-001", front: "Warum ist eine Werksküche i.d.R. eine nicht gewerbliche Einrichtung?", back: "Weil sie ausschließlich der Versorgung von Betriebsangehörigen dient und keine Gewinnerzielungsabsicht besteht. Sie gilt als Teil des Unternehmens, nicht als eigenständiges Gewerbe.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-002", front: "Beschränkungen bei der Ausübung der Buschenschank?", back: "Ausschank nur selbst erzeugter Produkte (z.B. Wein, Most, Säfte). Keine warme Küche (nur kalte Speisen erlaubt).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-003", front: "Maßnahmen gegen Buschenschankbetreiber bei Überschreitung der Befugnisse?", back: "Verwaltungsstrafen durch die Bezirksverwaltungsbehörde. Unterstützung und Beratung durch die Wirtschaftskammer.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-004", front: "Bedingungen für Zimmervermietung ohne Gewerbeberechtigung?", back: "Weniger als 10 Betten. Privatzimmervermietung ohne zusätzliche gewerbliche Leistungen. Keine Speisekarte.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-005", front: "Zuständige Behörden für gewerberechtliche Angelegenheiten im Gastgewerbe?", back: "Die Bezirkshauptmannschaft oder der Magistrat (je nach Standort).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-006", front: "Persönliche & sachliche Voraussetzungen für Gastgewerbeeröffnung?", back: "Volljährigkeit, Eigenberechtigung, keine Ausschlussgründe (z.B. Vorstrafen), Nachweis der Befähigung (z.B. Befähigungsprüfung), geeignete Betriebsstätte.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-007", front: "Wann benötigt man eine Betriebsanlagengenehmigung? Erleichterungen im Gastgewerbe?", back: "Generell bei Gefährdungspotential. Erleichterungen: Anlagen wie in Privathaushalten; Räumlichkeiten bis 800m² und Anschlussleistung bis 300kW.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-008", front: "Wer kann im Betriebsanlagenverfahren Rechte geltend machen/berufen?", back: "Antragsteller (Gewerbetreibender), Nachbarn (bei Beeinträchtigung), Arbeitsinspektorat.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-009", front: "Wirkung der Anmeldung eines Gewerbes?", back: "Recht zur Ausübung der gewerblichen Tätigkeit. Eintrag in das Gewerberegister. Gilt als behördliche Erlaubnis.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-010", front: "Wodurch wird der Umfang der Gewerbeberechtigung definiert?", back: "Durch die genaue Gewerbeanmeldung (gewerbliche Bezeichnung) und die Gewerbeart (frei, reglementiert, konzessioniert).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-011", front: "Wann darf mit der Ausübung eines Gewerbes begonnen werden?", back: "Freie Gewerbe: sofort nach Anmeldung. Reglementierte Gewerbe: erst nach Nachweis der Befähigung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-012", front: "Was bedeutet die Standortgebundenheit des Gastgewerbes?", back: "Die Berechtigung gilt nur für den angegebenen Standort. Verlegung erfordert neue Genehmigung (Eintrag im GISA).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-013", front: "Kann ein Gastwirt außerhalb seines Standortes tätig werden?", back: "Ja, im Rahmen einer genehmigten Außenstelle oder bei Veranstaltungen mit entsprechender Genehmigung (z.B. Catering).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-014", front: "Welche Bedeutung hat die 'Betriebsart'?", back: "Die Betriebsart (z.B. Kaffeehaus, Gasthaus, Hotel) legt den Rahmen und Umfang der erlaubten Tätigkeiten fest.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-015", front: "Ausnahmen vom Grundsatz der persönlichen Ausübung der Gewerbeberechtigung?", back: "Bestellung eines gewerberechtlichen Geschäftsführers (muss fachlich geeignet und ständig im Betrieb tätig sein).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-016", front: "Wofür haftet der gewerberechtliche Geschäftsführer?", back: "Für die Einhaltung der gewerberechtlichen Vorschriften, Öffnungszeiten, Jugendschutz, Preisauszeichnungen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-017", front: "Wann kann die Gewerbeberechtigung von der Behörde entzogen werden?", back: "Bei wiederholten schwerwiegenden Verstößen oder bei Wegfall der persönlichen Voraussetzungen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-018", front: "Wichtige Hauptrechte/Nebenrechte des Gastgewerbes?", back: "Haupt: Verabreichung Speisen, Ausschank Getränke, Beherbergung. Neben (max. 30% Umsatz): Tabakwaren, Veranstaltungen, Spielgeräte, Souvenirs.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-019", front: "Was ist beim 'Gästewagengewerbe' zu beachten?", back: "Gewerbeberechtigung notwendig. Beförderung von Gästen mit Fahrzeugen. Einhaltung techn. Vorschriften & Versicherungspflichten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-020", front: "Welche Vorschriften sind im Betrieb auszuhängen?", back: "Arbeitsrechtl. Gesetze (ArbeitszeitG, MutterSchG), Preisauszeichnung, Rauchverbotshinweise, Jugendschutzbestimmungen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-021", front: "Was versteht man unter der 'freien Gewerbeausübung'?", back: "Gewerbe, für die kein Befähigungsnachweis erforderlich ist.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-022", front: "Nennen Sie Beispiele für reglementierte Gewerbe im Gastgewerbe.", back: "Gastgewerbe in der Betriebsart Hotel, Gasthof, Restaurant; Fleischer; Bäcker.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-023", front: "Was ist der Unterschied zwischen einer Gewerbeanmeldung und einer Gewerbeberechtigung?", back: "Anmeldung ist der Akt, Berechtigung ist das Recht zur Ausübung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-024", front: "Welche Rolle spielt die Wirtschaftskammer für Gewerbetreibende?", back: "Interessenvertretung, Serviceleistungen, Beratung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-025", front: "Was sind die wesentlichen Inhalte eines Gesellschaftsvertrages einer OG?", back: "Firma, Sitz, Gesellschafter, Unternehmensgegenstand, Vertretungsbefugnis, Gewinn-/Verlustverteilung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-026", front: "Was versteht man unter 'Firmenbuch'?", back: "Öffentliches Verzeichnis, in das Unternehmen eingetragen werden müssen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-027", front: "Wer muss sich ins Firmenbuch eintragen lassen?", back: "Kapitalgesellschaften, eingetragene Personengesellschaften, Einzelunternehmer ab bestimmter Umsatzgrenze.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-028", front: "Was ist der GISA-Auszug?", back: "Auszug aus dem Gewerbeinformationssystem Austria, bestätigt die Gewerbeberechtigung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-029", front: "Welche Angaben muss eine Rechnung im Gastgewerbe enthalten?", back: "Name/Anschrift Leistender & Leistungsempfänger, Menge/Art Leistung, Entgelt, Steuersatz, Ausstellungsdatum, Rechnungsnummer, UID-Nummer bei Beträgen über € 400,-.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-030", front: "Was versteht man unter 'Preisauszeichnungspflicht'?", back: "Verpflichtung, Preise für Speisen und Getränke klar und deutlich sichtbar zu machen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-031", front: "Welche Informationen müssen auf einer Speisekarte angeführt sein?", back: "Bezeichnung der Speisen/Getränke, Preise inkl. aller Steuern und Bedienungsgeld, ggf. Allergeninformation.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-032", front: "Was sind die Aufgaben des Arbeitsinspektorats?", back: "Überwachung der Einhaltung von Arbeitnehmerschutzvorschriften, Beratung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-011", front: "Umsatzsteuersätze in der Gastro (Beispiele)?", back: "10% (Speisen, alkoholfreie Getränke, Beherbergung), 20% (alkoholische Getränke), 13% (Wein ab Hof, Schwimmbäder).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-012", front: "Was ist ein Dienstzettel?", back: "Schriftliche Aufzeichnung des wesentlichen Inhalts eines Dienstverhältnisses (Gehalt, Arbeitszeit, Dauer etc.), wenn kein schriftlicher Vertrag vorliegt.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-013", front: "Unterschied befristeter vs. unbefristeter Arbeitsvertrag?", back: "Unbefristet: auf unbestimmte Zeit, endet durch Kündigung etc. Befristet: für bestimmten Zeitraum, endet automatisch (Kündigung erschwert).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-014", front: "Probezeit für Arbeiter und Angestellte im Gastgewerbe?", back: "Ein Monat (laut Kollektivvertrag).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-015", front: "Kündigungsfrist Arbeitnehmer vs. Arbeitgeber (grob)?", back: "Arbeitnehmer: i.d.R. 1 Monat zum Monatsletzten. Arbeitgeber: je nach Dienstjahren, 6 Wochen bis 5 Monate.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-016", front: "Was regelt der Kollektivvertrag (KV)?", back: "Gehälter, Arbeitszeiten, Zuschläge etc. für eine Branche. Wird zwischen Arbeitnehmer- und Arbeitgebervertretern ausgehandelt.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-017", front: "Haftung der Geschäftsführung (GmbH)?", back: "Bei Verschulden haftet der Geschäftsführer auch mit seinem Privatvermögen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-018", front: "Nenne 2 Personengesellschaften.", back: "Offene Gesellschaft (OG), Kommanditgesellschaft (KG).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-019", front: "Kommunalsteuer: Bemessungsgrundlage & Höhe?", back: "3% der gesamten Bruttolohnsumme aller Dienstnehmer. Wird von der Gemeinde eingehoben.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-020", front: "Arten der Auflösung eines Arbeitsverhältnisses (Nenne 3).", back: "Kündigung, Entlassung, vorzeitiger Austritt, einvernehmliche Lösung, Zeitablauf (bei Befristung).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-033", front: "Nennen Sie 3 Gründe für eine Entlassung eines Dienstnehmers.", back: "Vertrauensunwürdigkeit, beharrliche Pflichtverletzung, grobe Ehrenbeleidigung, Diebstahl.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-034", front: "Was ist der Unterschied zwischen Kündigung und Entlassung?", back: "Kündigung beendet Dienstverhältnis unter Einhaltung von Fristen/Terminen. Entlassung ist fristlose Beendigung aus wichtigem Grund.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-035", front: "Was versteht man unter 'Urlaubsentgelt' und 'Urlaubszuschuss'?", back: "Urlaubsentgelt: Fortzahlung des Lohns während des Urlaubs. Urlaubszuschuss: zusätzliche Zahlung (13. Gehalt).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-036", front: "Welche Arten von Arbeitszeitmodellen gibt es im Gastgewerbe?", back: "Vollzeit, Teilzeit, geringfügige Beschäftigung, Saisonarbeit, flexible Arbeitszeitmodelle.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-037", front: "Was sind Überstunden und wie sind sie abzugelten?", back: "Arbeitszeit über Normalarbeitszeit. Abgeltung durch Zeitausgleich oder Zuschlag (meist 50%).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-038", front: "Welche Pflichten hat der Arbeitgeber im Bereich Arbeitssicherheit?", back: "Gefahrenermittlung, Unterweisung, Bereitstellung Schutzausrüstung, Bestellung Sicherheitsvertrauensperson.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-039", front: "Was ist eine 'Sicherheitsvertrauensperson' (SVP)?", back: "Von Belegschaft gewählte Person, die Interessen der Arbeitnehmer in Sicherheitsfragen vertritt.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-040", front: "Nennen Sie 3 wichtige Aspekte des Datenschutzes (DSGVO) im Gastgewerbe.", back: "Rechtmäßige Verarbeitung personenbezogener Daten (Gästelisten, Reservierungen), Informationspflicht, Datensicherheit, Löschpflichten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-041", front: "Was ist die 'Registrierkassenpflicht'?", back: "Verpflichtung zur Verwendung einer elektronischen Registrierkasse zur Erfassung von Barumsätzen ab bestimmten Umsatzgrenzen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-042", front: "Was ist ein 'Manipulationsschutz' bei Registrierkassen?", back: "Technische Sicherheitseinrichtung zur Verhinderung von Manipulationen der Kassendaten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-043", front: "Welche Aufbewahrungsfristen gelten für geschäftliche Unterlagen?", back: "Generell 7 Jahre für Buchhaltungsunterlagen, Rechnungen, etc.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-044", front: "Was versteht man unter 'Sperrstunde'?", back: "Gesetzlich oder behördlich festgelegte Zeit, zu der Gastbetriebe schließen müssen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-rkd-045", front: "Was sind die Konsequenzen bei Nichteinhaltung des Jugendschutzes?", back: "Verwaltungsstrafen, im Wiederholungsfall bis zum Entzug der Gewerbeberechtigung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() }
                ],
                createdAt: new Date().toISOString()
            },
            {
                id: "deck-pruef-kueche-lebensmittel-01", // ID for the target deck
                name: "Lebensmittelkunde", // NEW NAME as requested by user
                cards: [
                    { id: "pk-card-1", front: "Strudelteig (Zutaten und Zubereitung)", back: "Weizenmehl (Typ 700), (lauwarmes) Wasser, Öl, Salz. Vermischen und Kneten, abdecken und 30 min ruhen lassen, ziehen bis man Zeitung lesen kann, er aber nicht reißt. Nachpinseln nicht mit Öl sondern Butter.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "pk-card-2", front: "Rezept Kaiserschmarren", back: "Eier Trennen, Eiweiß steif schlagen. Dotter mit Mehl, Milch, Backpulver und Zucker vermischen. (Rum-) Rosinen. Eischnee unterheben. In Pfanne mit Butter auf beiden Seiten anbraten. Zerreißen. Im Ofen fertig backen. Mit Puderzucker bestreuen (oder kurz vorm Ende mit Kristallzucker karamellisieren).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "pk-card-3", front: "Konservierungsmethoden (Beispiele)", back: "Einlegen (Essig, Öl, Alkohol), Wasser entziehen (Salz, Zucker), Einkochen, Einrexen, Einfrieren, Vakuumieren, Räuchern.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "pk-card-4", front: "Was ist Gratinieren?", back: "Überbacken, zb mit Käse oder Sauce Mornay (Béchamel + Käse). Küchengerät dafür ist der Salamander.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "pk-card-5", front: "Kaffeesorten und Zubereitung (Robusta vs. Arabica)", back: "Robusta (eher für Espresso, Tiefland (bis 500m)), Arabica (eher f. Filter, Hochland (500 bis 2500m)). Aufbrühmethode (Türkischer Kaffee) mit Arabica. Frenchpress mit Arabica.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-001", front: "Rezept Sachertorte (Kurzform)", back: "Schwere Sandmasse (Butter, Zucker, Mehl, Eidotter, Schoko, Eischnee). Backen, halbieren, aprikotieren, Schokoglasur.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-002", front: "Teigarten (Nenne 5)", back: "Backteige, Blätterteig, Brandteig, Germteig, Mürbteig, Strudelteig.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-003", front: "Einteilung Schwein: Rücken?", back: "Karree (für Schnitzel, Kotelett). Andere Teile: Kopf, Schulter (Schopf, Bug), Bauch, Lungenbraten (Filet).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-004", front: "Verwendung Schweinebauch + Beilagen?", back: "Schweinebauch Braten. Vitaminbeilage: grüne Bohnen (Speckmantel), Spinat. Sättigungsbeilage: Kartoffeln (Brat-, Pommes).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-005", front: "Aufteilung Rind: Hinterviertel (3 Beispiele)?", back: "Wadschinken (Gulasch), Schale (Rindsbraten), Nuss/Kugel (Schnitzel), Hieferscherzel (Hüftsteak), Tafelspitz.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-006", front: "Aufteilung Rind: Rücken ('Englischer')?", back: "Lungenbraten/Rinderfilet, Niedere Beiried (Roastbeef), Hohe Beiried/Rostbraten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-007", front: "Suppenarten & Bindung?", back: "Klare & gebundene Suppen. Bindung: Mehl (Einmach), Obers (Creme), Eigenstärke (Püree). Bsp: Minestrone, Griesnockerlsuppe.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-008", front: "Soßen Grundarten (3 Beispiele)?", back: "Braune Grundsaucen (Fleisch), Weiße Grundsaucen (Béchamel), Aufgeschlagene Buttersaucen (Hollandaise), Ölgrundsaucen (Mayonnaise).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-009", front: "Was ist Marinieren?", back: "Einlegen von Lebensmitteln in eine Sauce (Marinade) um Geschmack anzunehmen oder zart zu machen (z.B. Grillfleisch, Beizen). Auch Anmachen von Salat.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-010", front: "Nenne 5 Blattsalate.", back: "Chinakohl, Spinat, Eisberg, Vogerlsalat, Rucola, Kopfsalat, Römersalat, Feldsalat, Endivien, Radicchio.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-011", front: "Französisches Wort für Wurzelgemüse (fein gewürfelt)?", back: "la brunoise.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-012", front: "Was ist ein Kombidämpfer?", back: "Ein Backofen, der auch eine Dampfgarfunktion hat.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-013", front: "Küchenbrigade: Nenne 3 Positionen.", back: "Chef de Cuisine (Küchenchef), Sous Chef (Stellvertreter), Entremetier (Beilagen), Gardemanger (Kalte Küche), Patissier (Süßspeisen).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-014", front: "Herstellung Kartoffelsalat (kurz).", back: "Festkochende Kartoffeln wählen, bissfest kochen, schälen, schneiden. Marinieren mit Essig, Öl, Salz, Pfeffer, Zwiebeln, Brühe. Durchziehen lassen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-015", front: "Fleisch einfrieren & auftauen (wichtige Punkte).", back: "Beschriften, schnell kühlen & gefrieren (-18°C). Langsam im Kühlhaus auftauen. Kühlkette nicht unterbrechen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-016", front: "Temperaturen: Kühlhaus, Tiefkühler, Trockenlager?", back: "Kühlhaus: 2-8°C (Fisch ~0°C). Tiefkühler: mind. -18°C. Trockenlager: 15-23°C.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-017", front: "Fischarten: Nenne 3 Süßwasserfische.", back: "Zander, Hecht, Wels, Forelle, Karpfen, Saibling.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-018", front: "Geflügelverarbeitung: Was ist besonders zu beachten?", back: "Hygiene (Kreuzkontamination vermeiden!), komplett durchgaren (Kerntemperatur mind. 75°C).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-019", front: "Getreidearten (Nenne 3) & Pseudogetreide (Nenne 1).", back: "Getreide: Weizen, Roggen, Gerste, Hafer, Mais, Reis, Hirse. Pseudogetreide: Buchweizen, Amarant, Quinoa.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-020", front: "Unterschied Krusten- & Schalentiere (je 2 Bsp.).", back: "Krustentiere: Krebse, Garnelen, Hummer, Languste. Schalentiere: Austern, Muscheln.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-021", front: "Nenne 3 Grundbrühen (Fonds).", back: "Rinderfond, Kalbsfond, Geflügelfond, Fischfond, Gemüsefond.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-022", front: "Was ist der Unterschied zwischen einer Consommé und einer Bouillon?", back: "Consommé ist eine geklärte Kraftbrühe, Bouillon ist eine einfache, oft ungeklärte Fleisch- oder Knochenbrühe.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-023", front: "Nenne 3 Arten von Convenience-Produkten in der Küche.", back: "Küchenfertig (geputztes Gemüse), garfertig (Teigwaren), zubereitungsfertig (Fertiggerichte zum Erwärmen).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-024", front: "Was sind die Vorteile von Convenience-Produkten?", back: "Zeitersparnis, Kalkulationssicherheit, gleichbleibende Qualität, weniger Personalbedarf.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-025", front: "Was sind die Nachteile von Convenience-Produkten?", back: "Höherer Preis, Qualitätsverlust möglich, weniger Individualität, Zusatzstoffe.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-026", front: "Nenne 3 Garmethoden mit trockener Hitze.", back: "Braten (Pfanne, Ofen), Grillen, Backen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-027", front: "Nenne 3 Garmethoden mit feuchter Hitze.", back: "Kochen, Dämpfen, Dünsten, Pochieren, Schmoren.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-028", front: "Was bedeutet 'al dente' kochen?", back: "Bissfest kochen, besonders bei Teigwaren und Gemüse.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-029", front: "Erkläre den Begriff 'Mehlschwitze' (Roux).", back: "Mischung aus Mehl und Fett (meist Butter), dient zum Binden von Saucen und Suppen. Hell, blond oder braun.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-030", front: "Was ist eine 'Liaison'?", back: "Bindemittel aus Eigelb und Sahne zum Legieren von Suppen und Saucen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-031", front: "Nenne 3 klassische österreichische Suppeneinlagen.", back: "Frittaten, Grießnockerl, Leberknödel, Backerbsen, Kaspressknödel.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-032", front: "Was sind die Hauptbestandteile einer Mayonnaise?", back: "Eigelb, Öl, Senf, Essig oder Zitronensaft.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-033", front: "Nenne 3 Ableitungen der Sauce Hollandaise.", back: "Sauce Béarnaise (mit Estragon, Kerbel), Sauce Mousseline (mit geschlagener Sahne), Sauce Foyot (mit Fleischglace).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-034", front: "Wie wird ein Wiener Schnitzel korrekt zubereitet?", back: "Kalbsschnitzel dünn klopfen, salzen, in Mehl, Ei und Semmelbröseln panieren, in reichlich Butterschmalz oder Pflanzenöl goldbraun backen (soufflieren lassen).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-035", front: "Was versteht man unter 'Sous-vide-Garen'?", back: "Garen von Lebensmitteln im Vakuumbeutel bei niedriger, konstanter Temperatur im Wasserbad.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-036", front: "Nenne 3 Käsesorten aus Österreich.", back: "Bergkäse, Emmentaler, Graukäse, Schlierbacher, Mondseer.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-037", front: "Wie lagert man frische Kräuter am besten?", back: "Im Kühlschrank, leicht feucht in Papier oder einem feuchten Tuch eingeschlagen, oder in einem Glas mit etwas Wasser.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-038", front: "Was ist der Unterschied zwischen Obst und Gemüse (botanisch/kulinarisch)?", back: "Botanisch: Obst entsteht aus befruchteten Blüten, Gemüse aus anderen Pflanzenteilen. Kulinarisch: Obst meist süß und roh, Gemüse eher herzhaft und gekocht.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-039", front: "Nenne 3 Zitrusfrüchte.", back: "Zitrone, Orange, Grapefruit, Limette, Mandarine, Pomelo.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pkl-040", front: "Was sind Hülsenfrüchte? Nenne 3 Beispiele.", back: "Samen von Pflanzen aus der Familie der Fabaceae. Bsp: Bohnen, Linsen, Erbsen, Kichererbsen, Sojabohnen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() }
                ],
                createdAt: new Date().toISOString()
            },
            {
                id: "deck-pruef-getraenkekunde-01",
                name: "Prüfungsfragen - Getränkekunde",
                cards: [
                    { id: "card-pgk-001", front: "Weinbaugebiet Burgenland: Wofür bekannt? Nenne 2 DAC-Gebiete.", back: "Bekannt für Rotweine und Süßweine (Blaufränkisch). DAC-Gebiete: Neusiedlersee DAC, Leithaberg DAC, Rosalia DAC, Mittelburgenland DAC, Eisenberg DAC.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-002", front: "Kaffeesorten (Hauptarten) & Teearten (Grundtypen).", back: "Kaffee: Arabica, Robusta, (Liberica). Tee: Schwarztee, Grüntee, Weißer Tee. Früchte-/Kräutertees sind Aufgüsse.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-003", front: "Was ist ein Aperitif? Nenne 2 Beispiele.", back: "Getränk vor dem Essen zur Appetitanregung. Bsp: Campari Soda, Prosecco, trockener Sherry, Martini Dry.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-004", front: "Was ist ein Digestif? Nenne 2 Beispiele.", back: "Getränk nach dem Essen zur Verdauungsförderung. Bsp: Grappa, Cognac, Kräuterlikör, Whisky.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-005", front: "Bier brauen: Grundstoffe?", back: "Getreide (Gerste/Weizen), Hopfen, Wasser, Hefe.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-006", front: "Unterschied ober- & untergäriges Bier + je 1 Bsp.", back: "Obergärig: Hefe steigt auf, wärmere Gärung (15-20°C), z.B. Weizenbier, Altbier. Untergärig: Hefe sinkt ab, kühlere Gärung (5-9°C), z.B. Märzen/Lager, Pils.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-007", front: "Nenne 3 österreichische Rotwein-Rebsorten (DAC relevant).", back: "Zweigelt, Blaufränkisch, St. Laurent, Blauburger, Pinot Noir.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-008", front: "Nenne 3 österreichische Weißwein-Rebsorten (DAC relevant).", back: "Grüner Veltliner, Riesling, Weißburgunder, Chardonnay, Sauvignon Blanc, Welschriesling.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-009", front: "Wasserarten für die Gastronomie?", back: "Leitungswasser (Trinkwasserqualität in Ö), Sodawasser (mit CO2 versetzt), natürliches Mineralwasser (mit/ohne CO2, mind. 1g Mineralstoffe/l).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-010", front: "Unterschied Fruchtsaft, Fruchtnektar, Fruchtsaftlimonade?", back: "Fruchtsaft: 100% Fruchtanteil. Fruchtnektar: 25-50% Fruchtanteil. Fruchtsaftlimonade: geringerer Fruchtanteil (z.B. 10-30%), mit Wasser, Zucker etc. versetzt.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-011", front: "Weinbaugebiet Steiermark: Nenne 2 typische Rebsorten.", back: "Sauvignon Blanc, Welschriesling, Morillon (Chardonnay), Gelber Muskateller, Schilcher (Blauer Wildbacher).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-012", front: "Weinbaugebiet Niederösterreich: Nenne 2 DAC-Gebiete und deren Hauptrebsorten.", back: "Wachau (Grüner Veltliner, Riesling), Kamptal (Grüner Veltliner, Riesling), Kremstal (Grüner Veltliner, Riesling), Weinviertel (Grüner Veltliner).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-013", front: "Qualitätsstufen Wachau (Riesling/Grüner Veltliner)?", back: "Steinfeder (leicht), Federspiel (Kabinett), Smaragd (kräftig, Reserve).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-014", front: "Serviertemperatur: Weißwein, Rotwein, Schaumwein?", back: "Weißwein: 7-12°C. Rotwein: 14-18°C. Schaumwein: 5-10°C.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-015", front: "Was sind Prädikatsweine? Nenne 2 Stufen.", back: "Weine mit hohem Mostgewicht (KMW). Stufen: Spätlese, Auslese, Beerenauslese, Eiswein, Strohwein, Trockenbeerenauslese.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-016", front: "Unterschied Weinbrand / Branntwein?", back: "Weinbrand ist gebrannter Wein (Brandy). Branntwein ist ein Oberbegriff für jede Spirituose.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-017", front: "Champagner: Welche 3 Hauptrebsorten?", back: "Chardonnay, Pinot Noir (Blauburgunder), Pinot Meunier (Schwarzriesling).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-018", front: "Champagner: Was ist Degorgieren?", back: "Entfernen des Hefepfropfens aus der Flasche nach der zweiten Gärung (Flaschengärverfahren).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-019", front: "Nenne 3 Glasarten für Wein.", back: "Weißweinglas, Rotweinglas (z.B. Bordeauxglas, Burgunderglas), Süßweinglas, Sektflöte, Sektschale.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-020", front: "Kennzeichnung bei geschwefeltem Wein?", back: "Muss ab 10mg/l mit 'Enthält Sulfite' oder 'Enthält Schwefeldioxid' gekennzeichnet sein.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-021", front: "Was ist ein 'Cuvée'?", back: "Ein Wein, der aus verschiedenen Rebsorten oder Jahrgängen verschnitten wurde.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-022", front: "Nenne 2 bekannte österreichische Biermarken.", back: "Gösser, Stiegl, Zipfer, Ottakringer, Puntigamer (Beispiele).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-023", front: "Was ist der Unterschied zwischen einem 'Shortdrink' und einem 'Longdrink'?", back: "Shortdrink: kleinere Menge (oft stärker), z.B. Martini. Longdrink: größere Menge, oft mit Filler aufgefüllt (schwächer), z.B. Gin Tonic.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-024", front: "Erkläre 'on the rocks'.", back: "Ein Getränk (meist Spirituose) wird pur über Eiswürfel serviert.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-pgk-025", front: "Was ist ein 'Mocktail'?", back: "Ein alkoholfreier Cocktail.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() }
                ],
                createdAt: new Date().toISOString()
            },
            {
                id: "deck-pruef-hygiene-recht-betrieb-01",
                name: "Prüfungsfragen - Hygiene & Betrieb", // Corrected Name
                cards: [
                    { id: "card-phrb-001", front: "Buffet: Wie lange darf Warmes stehen? Was tun danach?", back: "Maximal 3 Stunden (bei mind. 75°C). Danach muss es wieder auf 100°C (Kerntemperatur 3 Min.) erhitzt oder entsorgt werden.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-002", front: "Hygiene in der Küche: Personenhygiene (3 Punkte)?", back: "Duschen vor Dienstantritt, Hände waschen, Haare bedecken, kein Schmuck, saubere Kleidung, Küchenschuhe, fernbleiben bei Krankheit/Wunden.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-003", front: "Was ist HACCP?", back: "Hazard Analysis Critical Control Points. System zur Selbstkontrolle zur Gefahrenanalyse und Vermeidung kritischer Punkte in der Lebensmittelproduktion.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-004", front: "Müllentsorgung: Was ist ein Abfallwirtschaftskonzept?", back: "Planung, wie viel von welchem Müll anfällt und wer diesen wie entsorgt. Altöl muss von befugtem Entsorger abgeholt werden.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-005", front: "Müssen Allergene gekennzeichnet werden?", back: "Ja, die 14 Hauptallergene müssen deklariert werden. Entweder direkt auf der Speisekarte oder durch mündliche Auskunft (mit schriftlicher Dokumentation).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-006", front: "Richtige Desinfektion (thermisch vs. chemisch)?", back: "Erst reinigen, dann desinfizieren. Thermisch: durch Hitze (z.B. Geschirrspüler >80°C). Chemisch: mit Desinfektionsmitteln.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-007", front: "Ersthilfekoffer: Kontrolle & Beschriftung?", back: "Jährlich Bestand und Ablaufdatum prüfen. Notrufnummern und Name des betrieblichen Ersthelfers müssen draufstehen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-008", front: "Wie brennende Fritteuse löschen?", back: "Mit einer Löschdecke oder einem Fettbrandlöscher. Niemals Wasser!", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-009", front: "Schädlingsbekämpfung (kurz)?", back: "Monitoring. Bei Befall: selbst bekämpfen (Fallen, Nützlinge) und kontaminierte Lebensmittel entsorgen. Bei starkem Befall: Kammerjäger.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-010", front: "Warenannahme: Worauf achten?", back: "Kühlkettenprotokoll kontrollieren. Sichtkontrolle (Verpackung, Aussehen), ggf. Temperaturmessung. Ware sofort richtig lagern.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-021", front: "Was sind kritische Kontrollpunkte (CCPs) im HACCP-Konzept?", back: "Punkte im Prozess, an denen eine Gefahr beherrscht werden muss, um ein Gesundheitsrisiko zu vermeiden oder auf ein akzeptables Maß zu reduzieren.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-022", front: "Nenne 3 Beispiele für CCPs in einer Restaurantküche.", back: "Kühltemperaturen, Kerntemperatur beim Garen, Warmhaltetemperaturen, Reinigung und Desinfektion von Arbeitsflächen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-023", front: "Was ist die Bedeutung der Allergeninformationsverordnung?", back: "Verpflichtet Betriebe, Gäste über das Vorhandensein der 14 Hauptallergene in unverpackten Lebensmitteln zu informieren.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-024", front: "Wie kann die Allergeninformation erfolgen?", back: "Schriftlich (Speisekarte, Aushang, digitale Systeme) oder mündlich durch geschultes Personal (mit schriftlicher Dokumentation im Hintergrund).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-025", front: "Nenne 5 der 14 Hauptallergene.", back: "Glutenhaltiges Getreide, Krebstiere, Eier, Fisch, Erdnüsse, Soja, Milch, Schalenfrüchte, Sellerie, Senf, Sesam, Sulfite, Lupinen, Weichtiere.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-026", front: "Was sind die Grundsätze der Personalhygiene?", back: "Regelmäßiges Händewaschen, saubere Arbeitskleidung, Haarschutz, kein Schmuck an Händen/Unterarmen, Abdeckung von Wunden, Fernbleiben bei ansteckenden Krankheiten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-027", front: "Wie oft sollten Hände beim Arbeiten mit Lebensmitteln gewaschen werden?", back: "Regelmäßig und gründlich, insbesondere nach Toilettenbesuch, Umgang mit rohen Lebensmitteln, Husten/Niesen, Müllentsorgung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-028", front: "Was ist bei der Reinigung und Desinfektion von Arbeitsflächen zu beachten?", back: "Erst reinigen (Schmutz entfernen), dann desinfizieren. Einwirkzeit des Desinfektionsmittels beachten. Ggf. mit Trinkwasser nachspülen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-029", front: "Welche Maßnahmen sind zur Schädlingsprävention wichtig?", back: "Sauberkeit, korrekte Lagerung von Lebensmitteln, Verschluss von Öffnungen, regelmäßige Kontrollen, ggf. professionelle Schädlingsbekämpfung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-030", front: "Was bedeutet 'Kühlkette'?", back: "Lückenlose Einhaltung der erforderlichen Kühltemperaturen für Lebensmittel von der Herstellung/Lieferung bis zum Verbraucher.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-031", front: "Welche Gefahren gehen von einer unterbrochenen Kühlkette aus?", back: "Vermehrung von Mikroorganismen, Verderb von Lebensmitteln, Gesundheitsrisiko für Konsumenten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-032", front: "Was ist beim Umgang mit rohem Fleisch und Geflügel besonders zu beachten?", back: "Kreuzkontamination vermeiden (separate Bretter/Messer), gründliches Erhitzen, Händehygiene.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-033", front: "Nenne 3 Maßnahmen zur Vermeidung von Kreuzkontamination.", back: "Getrennte Arbeitsbereiche/Geräte für rohe und gegarte Speisen, Farbcodierung von Schneidebrettern, gründliche Reinigung zwischendurch.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-034", front: "Was sind die Symptome einer Lebensmittelvergiftung?", back: "Übelkeit, Erbrechen, Durchfall, Bauchkrämpfe, Fieber – je nach Erreger unterschiedlich.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-phrb-035", front: "Welche Rolle spielt die Eigenverantwortung des Unternehmers im Lebensmittelrecht?", back: "Unternehmer ist für die Sicherheit der von ihm in Verkehr gebrachten Lebensmittel verantwortlich und muss dies durch Eigenkontrollen (z.B. HACCP) sicherstellen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-001", front: "Chef de Cuisine (Küchenchef)", back: "Gesamtleitung der Küche, Menüplanung, Einkauf, Personalführung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-002", front: "Sous Chef (Stellvertretender Küchenchef)", back: "Vertritt den Küchenchef, oft verantwortlich für einen bestimmten Bereich.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-003", front: "Saucier (Saucenkoch)", back: "Zuständig für Saucen, oft auch für Fleischgerichte und Fonds.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-004", front: "Gardemanger (Koch der kalten Küche)", back: "Verantwortlich für kalte Vorspeisen, Salate, Terrinen, Pasteten, Aufschnitt.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-005", front: "Entremetier (Beilagenkoch)", back: "Zuständig für Gemüsebeilagen, Eierspeisen, Kartoffelgerichte, oft auch Suppen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-006", front: "Rotisseur (Bratenkoch)", back: "Verantwortlich für Braten, Gegrilltes und Frittiertes.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-007", front: "Poissonnier (Fischkoch)", back: "Spezialisiert auf die Zubereitung von Fischgerichten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-008", front: "Patissier (Küchenkonditor)", back: "Zuständig für Süßspeisen, Desserts, Gebäck und Kuchen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-009", front: "Tournant (Springer/Wechselkoch)", back: "Vertritt Köche auf verschiedenen Posten bei Abwesenheit.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-010", front: "Commis de Cuisine (Jungkoch)", back: "Berufsanfänger nach der Ausbildung, unterstützt die Chef de Partie.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-011", front: "Apprenti (Küchenlehrling)", back: "Auszubildender in der Küche.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-012", front: "Cuisinier du Personal (Personalkoch)", back: "Zuständig für die Verpflegung der Mitarbeiter.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "kb-card-013", front: "Regimier (Diätkoch)", back: "Diätkoch. Zuständig für die Zubereitung von Diätkost und speziellen Ernährungsformen unter Berücksichtigung medizinischer Vorgaben.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() }
                ],
                createdAt: new Date().toISOString()
            },
            {
                id: "deck-pruef-service-hotel-01",
                name: "Prüfungsfragen - Service & Hotel",
                cards: [
                    { id: "card-psh-001", front: "Schlüsselsysteme im Hotel (Nenne 3).", back: "Mechanischer Schlüssel, Codekarte, Chipkarte (Keycard), QR-Code, Handy-App.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-002", front: "Was ist ein 'No Show' im Hotel?", back: "Ein Gast, der trotz Reservierung nicht zur vereinbarten Zeit eincheckt und nicht storniert hat.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-003", front: "Anbindung an Booking.com: Was ist Ratenparität?", back: "Klausel, dass der auf Booking.com angebotene Preis der günstigste sein muss. Seit 2016 in Ö unzulässig.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-004", front: "Der 'Englische' (Rinderrücken): Verwendung im Service/Speisekarte?", back: "Lungenbraten/Filet (z.B. Filet Wellington, Chateaubriand), Niedere Beiried (Roastbeef), Hohe Beiried (Rostbraten).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-005", front: "Aufgaben Front Office Mitarbeiter (Rezeptionist)? (Nenne 3)", back: "Check-In/Check-Out, Telefondienst, Reklamationsbearbeitung, Gästeinformation, Zimmervergabe, Meldewesen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-006", front: "Was ist Tranchieren? Nenne 2 weitere Arbeiten am Gasttisch.", back: "Tranchieren: Fachgerechtes Zerlegen von Fleisch/Geflügel. Weitere: Filetieren (Fisch, Obst), Flambieren.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-007", front: "Jugendschutzgesetz im Gastbetrieb (Alkohol)?", back: "Kein Alkohol unter 16. Ab 16 Bier/Wein erlaubt, keine gebrannten Alkoholika/Mischgetränke. Alles ab 18. (Regelungen je Bundesland beachten).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-008", front: "Klassische Menüreihenfolge (5 Gänge)?", back: "(Amuse Bouche), Kalte Vorspeise, Suppe, Warme Vorspeise, Fischgang, Hauptgang (Fleisch), Beilagen, Salat, Dessert, Käse, (Petit Fours).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-009", front: "Servierarten (Nenne 3).", back: "Tellerservice, Vorlegen (Französisches Service), Anrichten am Guéridon (Englisches Service), Einstellen von Platten/Schüsseln.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-010", front: "Was ist ein 'Package' bei einer Hotelbuchung?", back: "Ein Leistungspaket, z.B. Übernachtung + Frühstück + Zusatzleistungen (Halbpension, Wellness, Skipass).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-011", front: "Aufgaben Back Office im Hotel (Nenne 2).", back: "Reservierung, Marketing, Buchhaltung, Personalverwaltung, Geschäftsführung.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-012", front: "Frühstücksarten (Nenne 3).", back: "Einfaches Frühstück, Kontinentales Frühstück, Erweitertes Frühstück, Wiener Frühstück, Englisches Frühstück, Amerikanisches Frühstück. (Buffet oder à la carte).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-013", front: "Was macht ein Concierge?", back: "Erfüllt Gästewünsche, z.B. Buchen von Theaterkarten, Restaurantreservierungen, Organisation von Transporten.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-014", front: "Online Buchungsmöglichkeiten für Hotels (Nenne 2 OTAs).", back: "Hotel-Webseite, Booking.com, Expedia, HRS, Trivago.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-015", front: "Bedeutung: PMS, COS, OTA?", back: "PMS: Property Management System (Hotelsoftware). COS: Cost of Sale (Wareneinsatz). OTA: Online Travel Agent (Online Reisebüro).", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-016", front: "Hotelklassifizierung in Österreich (Sterne)?", back: "Einheitliches System von 1 bis 5 Sternen, jeweils auch 'Superior' möglich. Bewertung durch unabhängige Kommission.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-017", front: "Gästeblätter: Aufbewahrungsfrist?", back: "Müssen 7 Jahre aufbewahrt werden.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-018", front: "Was ist ein Jus (in der Küche)?", back: "Saft, typischerweise ein konzentrierter Bratensaft oder Fleischsaft.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-019", front: "Buffetarten (Nenne 3 Kategorien).", back: "Kaltes Buffet, Warmes Buffet, Gemischtes Buffet, Salatbuffet, Dessertbuffet, Frühstücksbuffet.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-020", front: "Arten der Gastronomie (ohne Beherbergung, volles Angebot)?", back: "Gasthaus, Restaurant, Kaffeerestaurant.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-021", front: "Was ist ein 'Walk-out' im Hotel?", back: "Ein Gast, der das Hotel verlässt, ohne die Rechnung zu bezahlen.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-022", front: "Nenne 3 Arten von Hotelzimmern.", back: "Einzelzimmer, Doppelzimmer, Suite, Familienzimmer, barrierefreies Zimmer.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-023", front: "Was bedeutet 'Yield Management' im Hotel?", back: "Preisstrategie zur Maximierung des Umsatzes durch flexible Anpassung der Zimmerpreise an Nachfrage und Buchungssituation.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-024", front: "Welche Informationen enthält ein Meldezettel?", back: "Name, Geburtsdatum, Staatsangehörigkeit, Adresse des Gastes, Ankunfts- und Abreisedatum.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() },
                    { id: "card-psh-025", front: "Was ist ein 'Contingent' (Kontingent) im Hotelwesen?", back: "Eine bestimmte Anzahl von Zimmern, die einem Reiseveranstalter oder einer Firma zu speziellen Konditionen zur Verfügung gestellt wird.", difficulty: 'new', lastReviewed: null, nextReview: null, reviewCount: 0, createdAt: new Date().toISOString() }
                ],
                createdAt: new Date().toISOString()
            }
        ];

        // --- APPLICATION STATE ---
        let userDecksFromStorage = [];
        try {
            const storedDecksString = localStorage.getItem('decks');
            if (storedDecksString) {
                const parsedDecks = JSON.parse(storedDecksString);
                if (Array.isArray(parsedDecks)) { 
                    userDecksFromStorage = parsedDecks;
                } else {
                    console.warn("[State Init] Stored 'decks' is not an array, initializing as empty. Stored value:", storedDecksString);
                    userDecksFromStorage = []; // Ensure it's an array
                }
            }
        } catch (e) {
            console.error("[State Init] Error parsing decks from localStorage:", e);
            userDecksFromStorage = []; // Fallback to empty array on error
        }

        // Start with user's decks from storage
        let combinedDecks = Array.isArray(userDecksFromStorage) ? JSON.parse(JSON.stringify(userDecksFromStorage)) : []; 

        // Get IDs of decks already loaded from storage
        const loadedDeckIds = new Set(combinedDecks.map(deck => String(deck.id)));

        // Add predefined decks and their cards if their IDs are not already in loadedDeckIds
        // If a predefined deck ID IS in loadedDeckIds, merge only NEW cards from predefined into the user's existing deck
        predefinedDecks.forEach(predefinedDeck => {
            const predefinedDeckIdStr = String(predefinedDeck.id);
            const existingUserDeckIndex = combinedDecks.findIndex(d => String(d.id) === predefinedDeckIdStr);

            if (existingUserDeckIndex === -1) {
                // This predefined deck is new to the user, add it completely.
                combinedDecks.push(JSON.parse(JSON.stringify(predefinedDeck))); // Add a deep copy
                // console.log(`[State Init] Adding new predefined deck: ${predefinedDeck.name} (ID: ${predefinedDeckIdStr})`);
            } else {
                // The deck ID exists in user's storage.
                const userDeck = combinedDecks[existingUserDeckIndex];
                
                // Ensure the name from predefinedDecks is used if the user hasn't changed it from an "Beispiele" name or the specific "Lebensmittelkunde" or "Prüfungsfragen - Hygiene, Recht & Betrieb" case
                const oldNameForPkl = "Prüfungsfragen - Küche & Lebensmittel"; 
                const oldNameForHygiene = "Prüfungsfragen - Hygiene, Recht & Betrieb";
                
                if (predefinedDeck.id === "deck-pruef-kueche-lebensmittel-01" && userDeck.name === oldNameForPkl) {
                     userDeck.name = predefinedDeck.name; // Update to "Lebensmittelkunde"
                     console.log(`[State Init] Updated deck name for ID ${predefinedDeckIdStr} to: ${predefinedDeck.name}`);
                } else if (predefinedDeck.id === "deck-pruef-hygiene-recht-betrieb-01" && userDeck.name === oldNameForHygiene) {
                    userDeck.name = predefinedDeck.name; // Update to "Prüfungsfragen - Hygiene & Betrieb"
                    console.log(`[State Init] Updated deck name for ID ${predefinedDeckIdStr} to: ${predefinedDeck.name}`);
                }


                // Merge cards: Add cards from predefinedDeck if they don't exist in userDeck
                const userCardIds = new Set(userDeck.cards.map(card => String(card.id)));
                let newCardsAddedToExistingDeck = 0;
                predefinedDeck.cards.forEach(predefinedCard => {
                    if (!userCardIds.has(String(predefinedCard.id))) {
                        userDeck.cards.push(JSON.parse(JSON.stringify(predefinedCard))); // Add a deep copy of the new card
                        newCardsAddedToExistingDeck++;
                    }
                });
                if (newCardsAddedToExistingDeck > 0) {
                    console.log(`[State Init] Added ${newCardsAddedToExistingDeck} new cards to existing user deck '${userDeck.name}' from predefined deck '${predefinedDeck.name}'.`);
                }
            }
        });


        const state = {
            decks: combinedDecks, 
            currentDeckId: null,      
            currentCardId: null,      
            cardToMoveId: null,       
            studyCards: [],           
            currentStudyIndex: 0,     
            isFlipped: false,         
            studyMode: 'normal', // 'normal', 'again', 'hard', 'easy', 'test'
            stats: JSON.parse(localStorage.getItem('stats')) || { 
                decksCount: 0,
                cardsCount: 0,
                studiedToday: 0,
                activity: Array(7).fill(0), 
                lastStudyDate: null         
            }
        };

        // --- DOM ELEMENTS CACHE ---
        const elements = {
            welcomeScreen: document.getElementById('welcomeScreen'),
            deckView: document.getElementById('deckView'),
            studyView: document.getElementById('studyView'),
            statsView: document.getElementById('statsView'),
            decksList: document.getElementById('decksList'),
            cardsList: document.getElementById('cardsList'),
            deckTitle: document.getElementById('deckTitle'),
            deckStats: document.getElementById('deckStats'),
            cardFront: document.getElementById('cardFront'),
            cardBack: document.getElementById('cardBack'),
            cardContainer: document.getElementById('cardContainer'),
            answerButtons: document.getElementById('answerButtons'),
            studyComplete: document.getElementById('studyComplete'),
            cardsRemaining: document.getElementById('cardsRemaining'),
            studyProgress: document.getElementById('studyProgress'),
            progressBar: document.getElementById('progressBar'),
            studyModeIndicator: document.getElementById('studyModeIndicator'),
            cardModal: document.getElementById('cardModal'),
            deckModal: document.getElementById('deckModal'),
            moveCardModal: document.getElementById('moveCardModal'), 
            moveCardModalFront: document.getElementById('moveCardModalFront'), 
            targetDeckSelect: document.getElementById('targetDeckSelect'), 
            modalTitle: document.getElementById('modalTitle'),
            cardFrontInput: document.getElementById('cardFrontInput'),
            cardBackInput: document.getElementById('cardBackInput'),
            deckNameInput: document.getElementById('deckNameInput'),
            createDeckBtn: document.getElementById('createDeckBtn'),
            welcomeCreateDeckBtn: document.getElementById('welcomeCreateDeckBtn'),
            addCardBtn: document.getElementById('addCardBtn'),
            studyDeckBtn: document.getElementById('studyDeckBtn'),
            studyAgainBtn: document.getElementById('studyAgainBtn'),
            studyHardBtn: document.getElementById('studyHardBtn'),
            studyEasyBtn: document.getElementById('studyEasyBtn'),
            studyTestBtn: document.getElementById('studyTestBtn'),
            returnToDeckBtn: document.getElementById('returnToDeckBtn'),
            saveCardBtn: document.getElementById('saveCardBtn'),
            cancelCardBtn: document.getElementById('cancelCardBtn'),
            saveDeckBtn: document.getElementById('saveDeckBtn'),
            cancelDeckBtn: document.getElementById('cancelDeckBtn'),
            cancelMoveCardBtn: document.getElementById('cancelMoveCardBtn'), 
            confirmMoveCardBtn: document.getElementById('confirmMoveCardBtn'), 
            sidebarToggle: document.getElementById('sidebarToggle'),
            closeSidebarBtn: document.getElementById('closeSidebarBtn'),
            sidebarOverlay: document.getElementById('sidebarOverlay'),
            backBtn: document.getElementById('backBtn'), 
            syncBtn: document.getElementById('syncBtn'),
            statsBtn: document.getElementById('statsBtn'),
            currentDeckTitle: document.getElementById('currentDeckTitle'), 
            statsDecksCount: document.getElementById('statsDecksCount'),
            statsCardsCount: document.getElementById('statsCardsCount'),
            statsStudiedToday: document.getElementById('statsStudiedToday'),
            deckProgressList: document.getElementById('deckProgressList'),
            activityChart: document.getElementById('activityChart'),
            mainContent: document.getElementById('mainContent')
        };

        // --- INITIALIZATION ---
        function init() {
            renderDecksList();
            updateStats(); 
            setupEventListeners();
            showWelcomeScreen();
        }

        // --- EVENT LISTENERS SETUP ---
        function setupEventListeners() {
            elements.createDeckBtn.addEventListener('click', () => showDeckModal(false)); // For new deck
            elements.welcomeCreateDeckBtn.addEventListener('click', () => showDeckModal(false)); // For new deck
            elements.addCardBtn.addEventListener('click', () => showCardModal(null)); 
            elements.studyDeckBtn.addEventListener('click', () => startStudySession('normal'));
            
            elements.studyAgainBtn.addEventListener('click', () => startStudySession('again'));
            elements.studyHardBtn.addEventListener('click', () => startStudySession('hard'));
            elements.studyEasyBtn.addEventListener('click', () => startStudySession('easy'));
            elements.studyTestBtn.addEventListener('click', () => startStudySession('test'));

            elements.returnToDeckBtn.addEventListener('click', returnToDeck);
            elements.syncBtn.addEventListener('click', syncData);
            elements.statsBtn.addEventListener('click', showStatsView);
            
            elements.sidebarToggle.addEventListener('click', toggleSidebar);
            elements.closeSidebarBtn.addEventListener('click', toggleSidebar);
            elements.sidebarOverlay.addEventListener('click', toggleSidebar);


            elements.backBtn.addEventListener('click', handleBackNavigation); 

            elements.saveCardBtn.addEventListener('click', saveCard);
            elements.cancelCardBtn.addEventListener('click', hideCardModal);
            elements.saveDeckBtn.addEventListener('click', saveDeck);
            elements.cancelDeckBtn.addEventListener('click', hideDeckModal);
            elements.cancelMoveCardBtn.addEventListener('click', hideMoveCardModal); 
            elements.confirmMoveCardBtn.addEventListener('click', confirmMoveCard); 

            elements.cardContainer.addEventListener('click', flipCard);

            document.querySelectorAll('#answerButtons button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const difficulty = e.currentTarget.dataset.difficulty; 
                    handleAnswer(difficulty);
                });
            });
        }

        // --- RENDERING FUNCTIONS ---
        function renderDecksList() {
            elements.decksList.innerHTML = ''; 
            
            state.decks.forEach(deck => {
                const deckElement = document.createElement('div');
                deckElement.className = 'sidebar-item group flex items-center px-2 py-2 text-sm font-medium rounded-md cursor-pointer transition-colors';
                deckElement.innerHTML = `
                    <div class="flex items-center flex-1 min-w-0"> <div class="flex-shrink-0 w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center">
                            <i class="fas fa-layer-group text-indigo-600"></i>
                        </div>
                        <div class="ml-3 min-w-0"> <p class="text-sm font-medium text-gray-900">${escapeHTML(deck.name)}</p>
                            <p class="text-xs text-gray-500">${deck.cards.length} Karten</p>
                        </div>
                    </div>
                    <div class="flex items-center opacity-0 group-hover:opacity-100 transition-opacity">
                        <button class="edit-deck p-1 text-gray-500 hover:text-indigo-600 transition-colors" data-id="${deck.id}" title="Deck bearbeiten">
                            <i class="fas fa-edit text-xs"></i>
                        </button>
                        <button class="delete-deck p-1 text-gray-500 hover:text-red-600 ml-1 transition-colors" data-id="${deck.id}" title="Deck löschen">
                            <i class="fas fa-trash text-xs"></i>
                        </button>
                    </div>
                `;
                
                deckElement.querySelector('.flex-1').addEventListener('click', () => {
                    showDeck(deck.id);
                    if (window.innerWidth < 768) { // md breakpoint
                        toggleSidebar(); // Close sidebar on mobile after selection
                    }
                });
                
                const editBtn = deckElement.querySelector('.edit-deck');
                const deleteBtn = deckElement.querySelector('.delete-deck');
                
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    const deckId = e.currentTarget.dataset.id;
                    if (!deckId) { console.error("[EditDeck Listener] No data-id found on edit button:", e.currentTarget); return; }
                    editDeck(deckId); 
                });
                
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    const deckId = e.currentTarget.dataset.id;
                    if (!deckId) { console.error("[DeleteDeck Listener] No data-id found on delete button:", e.currentTarget); return; }
                    deleteDeck(deckId); 
                });
                
                elements.decksList.appendChild(deckElement);
            });
            updateStats(); 
        }

        function renderCardsList(cards) {
            elements.cardsList.innerHTML = ''; 
            
            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'bg-white rounded-xl shadow-md overflow-hidden transition-all duration-200 card-hover';
                cardElement.innerHTML = `
                    <div class="p-4">
                        <div class="flex justify-between items-start">
                            <h3 class="text-lg font-medium text-gray-900 mb-2 break-words">${escapeHTML(card.front.substring(0, 50))}${card.front.length > 50 ? '...' : ''}</h3>
                            <div class="flex space-x-1">
                                <button class="move-card p-1 text-gray-500 hover:text-blue-600 transition-colors" data-id="${card.id}" title="Karte verschieben">
                                    <i class="fas fa-exchange-alt text-sm"></i>
                                </button>
                                <button class="edit-card p-1 text-gray-500 hover:text-indigo-600 transition-colors" data-id="${card.id}" title="Karte bearbeiten">
                                    <i class="fas fa-edit text-sm"></i>
                                </button>
                                <button class="delete-card p-1 text-gray-500 hover:text-red-600 transition-colors" data-id="${card.id}" title="Karte löschen">
                                    <i class="fas fa-trash text-sm"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-600 text-sm break-words">${escapeHTML(card.back.substring(0, 100))}${card.back.length > 100 ? '...' : ''}</p>
                        <div class="mt-3 pt-3 border-t border-gray-100 flex justify-between items-center">
                            <span class="text-xs text-gray-500">Zuletzt gelernt: ${card.lastReviewed ? new Date(card.lastReviewed).toLocaleDateString('de-DE') : 'Nie'}</span>
                            <span class="text-xs px-2 py-1 rounded-full ${getDifficultyClass(card.difficulty)}">${getDifficultyText(card.difficulty)}</span>
                        </div>
                    </div>
                `;
                
                const moveBtn = cardElement.querySelector('.move-card'); 
                const editBtn = cardElement.querySelector('.edit-card');
                const deleteBtn = cardElement.querySelector('.delete-card');

                moveBtn.addEventListener('click', (e) => { 
                    e.stopPropagation();
                    const cardId = e.currentTarget.dataset.id;
                    if (!cardId) { console.error("[MoveCard Listener] No data-id found on move button:", e.currentTarget); return; }
                    showMoveCardModal(cardId); 
                });
                
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const cardId = e.currentTarget.dataset.id;
                    if (!cardId) { console.error("[EditCard Listener] No data-id found on edit button:", e.currentTarget); return; }
                    showCardModal(cardId); 
                });
                
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const cardId = e.currentTarget.dataset.id;
                     if (!cardId) { console.error("[DeleteCard Listener] No data-id found on delete button:", e.currentTarget); return; }
                    deleteCard(cardId); 
                });
                
                elements.cardsList.appendChild(cardElement);
            });
        }

        function renderStats() {
            elements.statsDecksCount.textContent = state.stats.decksCount;
            elements.statsCardsCount.textContent = state.stats.cardsCount;
            elements.statsStudiedToday.textContent = state.stats.studiedToday;
            
            renderDeckProgress();
            renderActivityChart();
        }

        function renderDeckProgress() {
            elements.deckProgressList.innerHTML = ''; 
            
            state.decks.forEach(deck => {
                const totalCards = deck.cards.length;
                const studiedCards = deck.cards.filter(c => c.reviewCount > 0).length;
                const percentage = totalCards > 0 ? Math.round((studiedCards / totalCards) * 100) : 0;
                
                const progressElement = document.createElement('div');
                progressElement.className = 'bg-white border border-gray-200 rounded-xl p-4';
                progressElement.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <h4 class="font-medium text-gray-800">${escapeHTML(deck.name)}</h4>
                        <span class="text-sm font-medium text-gray-600">${studiedCards}/${totalCards} Karten</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="gradient-bg h-2.5 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                `;
                elements.deckProgressList.appendChild(progressElement);
            });
        }

        function renderActivityChart() {
            const canvas = elements.activityChart;
            const ctx = canvas.getContext('2d');
            
            canvas.width = canvas.offsetWidth; // Make chart responsive
            canvas.height = 200; 
            
            const days = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa']; 
            const data = state.stats.activity; 
            
            ctx.clearRect(0, 0, canvas.width, canvas.height); 
            
            const padding = 20; 
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding - 20; // Space for x-axis labels
            const barPadding = 10; 
            const numBars = days.length;
            const barWidth = (chartWidth - (numBars - 1) * barPadding) / numBars;
            
            const maxValue = Math.max(...data, 1); // Ensure maxValue is at least 1 to prevent division by zero

            // Draw Y-axis labels
            ctx.fillStyle = '#6B7280'; // Tailwind gray-500
            ctx.font = '10px Arial';
            ctx.textAlign = 'right';
            ctx.fillText(maxValue.toString(), padding - 5, padding + 5); // Top label
            ctx.fillText('0', padding - 5, padding + chartHeight); // Bottom label

            // Draw bars and X-axis labels
            data.forEach((value, index) => {
                const barHeight = (value / maxValue) * chartHeight;
                const x = padding + index * (barWidth + barPadding);
                const y = padding + chartHeight - barHeight;
                
                const gradient = ctx.createLinearGradient(x, y, x, y + barHeight);
                gradient.addColorStop(0, '#6366f1'); // Tailwind indigo-500
                gradient.addColorStop(1, '#8b5cf6'); // Tailwind purple-500
                ctx.fillStyle = gradient;
                
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // X-axis labels
                ctx.fillStyle = '#6B7280'; // Tailwind gray-500
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(days[index], x + barWidth / 2, padding + chartHeight + 15); // Position labels below bars
                
                // Value labels on top of bars (optional)
                if (value > 0) {
                    ctx.fillStyle = '#1F2937'; // Tailwind gray-800
                    ctx.font = '10px Arial';
                    ctx.fillText(value.toString(), x + barWidth / 2, y - 5); // Position above the bar
                }
            });
            
            // Draw axes lines
            ctx.strokeStyle = '#D1D5DB'; // Tailwind gray-300
            ctx.beginPath();
            ctx.moveTo(padding, padding); // Start of Y-axis
            ctx.lineTo(padding, padding + chartHeight); // End of Y-axis / Start of X-axis
            ctx.lineTo(padding + chartWidth, padding + chartHeight); // End of X-axis
            ctx.stroke();
        }


        // --- VIEW MANAGEMENT ---
        function showDeck(deckId) {
            const deck = state.decks.find(d => d.id === deckId);
            if (!deck) {
                showWelcomeScreen(); 
                return;
            }

            state.currentDeckId = deckId;
            elements.currentDeckTitle.textContent = deck.name; 
            
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeDeckElement = Array.from(elements.decksList.children).find(child => {
                return child.querySelector(`.edit-deck[data-id="${deckId}"], .delete-deck[data-id="${deckId}"]`);
            });
            if (activeDeckElement) {
                activeDeckElement.classList.add('active');
            }
            
            elements.welcomeScreen.classList.add('hidden');
            elements.deckView.classList.remove('hidden');
            elements.studyView.classList.add('hidden');
            elements.statsView.classList.add('hidden');
            elements.backBtn.classList.remove('hidden'); 
            
            elements.deckTitle.textContent = deck.name;
            elements.deckStats.textContent = `${deck.cards.length} Karten`;
            
            renderCardsList(deck.cards);
        }

        function showWelcomeScreen() {
            elements.welcomeScreen.classList.remove('hidden');
            elements.deckView.classList.add('hidden');
            elements.studyView.classList.add('hidden');
            elements.statsView.classList.add('hidden');
            elements.currentDeckTitle.textContent = 'Willkommen'; 
            elements.backBtn.classList.add('hidden'); 
            
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            state.currentDeckId = null; 
        }

        function showStatsView() {
            updateStats(); 
            
            elements.welcomeScreen.classList.add('hidden');
            elements.deckView.classList.add('hidden');
            elements.studyView.classList.add('hidden');
            elements.statsView.classList.remove('hidden');
            elements.backBtn.classList.remove('hidden'); 
            
            elements.currentDeckTitle.textContent = 'Statistiken'; 
            renderStats();
        }

        // --- MODAL MANAGEMENT ---
        function showDeckModal(isEditMode = false, deckIdToEdit = null) { 
            if (isEditMode && deckIdToEdit) {
                const deck = state.decks.find(d => d.id === deckIdToEdit);
                if (!deck) {
                    console.error("[showDeckModal] Deck to edit not found:", deckIdToEdit);
                    return;
                }
                state.currentDeckId = deckIdToEdit; 
                elements.deckNameInput.value = deck.name;
                document.querySelector('#deckModal h3').textContent = 'Deck bearbeiten'; 
                elements.saveDeckBtn.textContent = 'Speichern'; 
            } else {
                state.currentDeckId = null; // Explicitly null for new deck
                elements.deckNameInput.value = ''; 
                document.querySelector('#deckModal h3').textContent = 'Neues Deck erstellen';
                elements.saveDeckBtn.textContent = 'Erstellen';
            }
            elements.deckModal.classList.remove('hidden');
            elements.deckNameInput.focus();
        }

        function hideDeckModal() {
            elements.deckModal.classList.add('hidden');
            // state.currentDeckId = null; // Clear only if it was a new deck creation attempt that was cancelled
        }

        function showCardModal(cardId) {
            const currentDeck = state.decks.find(d => d.id === state.currentDeckId);
            if (!currentDeck) {
                alert("Bitte wählen Sie zuerst ein Deck aus oder erstellen Sie eines.");
                console.error("No current deck selected to add/edit card.");
                return;
            }

            if (cardId) { 
                const card = currentDeck.cards.find(c => c.id === cardId);
                if (!card) return;
                
                state.currentCardId = cardId;
                elements.modalTitle.textContent = 'Karte bearbeiten';
                elements.cardFrontInput.value = card.front;
                elements.cardBackInput.value = card.back;
            } else { 
                state.currentCardId = null;
                elements.modalTitle.textContent = 'Neue Karte';
                elements.cardFrontInput.value = '';
                elements.cardBackInput.value = '';
            }
            elements.cardModal.classList.remove('hidden');
            elements.cardFrontInput.focus();
        }

        function hideCardModal() {
            elements.cardModal.classList.add('hidden');
        }

        function showMoveCardModal(cardId) {
            const sourceDeck = state.decks.find(d => d.id === state.currentDeckId);
            if (!sourceDeck) {
                console.error("Move Card Error: Source deck not found.");
                return;
            }
            const cardToMove = sourceDeck.cards.find(c => c.id === cardId);
            if (!cardToMove) {
                console.error("Move Card Error: Card not found in source deck.");
                return;
            }

            state.cardToMoveId = cardId;
            elements.moveCardModalFront.textContent = cardToMove.front.substring(0, 100) + (cardToMove.front.length > 100 ? '...' : '');

            elements.targetDeckSelect.innerHTML = ''; 
            let availableTargetDecks = 0;
            state.decks.forEach(deck => {
                if (deck.id !== state.currentDeckId) {
                    const option = document.createElement('option');
                    option.value = deck.id;
                    option.textContent = deck.name; // Corrected: No escapeHTML here for select options
                    elements.targetDeckSelect.appendChild(option);
                    availableTargetDecks++;
                }
            });

            if (availableTargetDecks === 0) {
                const option = document.createElement('option');
                option.textContent = "Keine anderen Decks verfügbar";
                option.disabled = true;
                elements.targetDeckSelect.appendChild(option);
                elements.confirmMoveCardBtn.disabled = true;
            } else {
                elements.confirmMoveCardBtn.disabled = false;
            }
            elements.moveCardModal.classList.remove('hidden');
        }

        function hideMoveCardModal() {
            elements.moveCardModal.classList.add('hidden');
            state.cardToMoveId = null;
        }


        // --- DATA MANIPULATION (DECKS) ---
        function saveDeck() {
            const name = elements.deckNameInput.value.trim();
            if (!name) {
                alert("Deckname darf nicht leer sein.");
                return;
            }
            
            let deckToSelectAfterSave; 

            if (state.currentDeckId) { // Update existing deck
                const deckIndex = state.decks.findIndex(d => d.id === state.currentDeckId);
                if (deckIndex !== -1) {
                    state.decks[deckIndex].name = name;
                    deckToSelectAfterSave = state.currentDeckId; 
                    console.log(`[SaveDeck] Updated deck ID ${state.currentDeckId} with name: ${name}`);
                } else {
                    console.error("[SaveDeck] Error: Deck to update not found in state, though currentDeckId was set:", state.currentDeckId);
                    hideDeckModal();
                    state.currentDeckId = null; // Clear broken state
                    return;
                }
            } else { // Create new deck
                const newDeck = {
                    id: Date.now().toString(), 
                    name: name,
                    cards: [], // New decks should always start with empty cards array
                    createdAt: new Date().toISOString()
                };
                state.decks.push(newDeck);
                deckToSelectAfterSave = newDeck.id; 
                console.log(`[SaveDeck] Created new deck: ${name} with ID ${newDeck.id}`);
            }

            updateStats();
            renderDecksList(); 
            hideDeckModal(); 
            state.currentDeckId = null; // Always clear after save operation for deck modal
            
            if(deckToSelectAfterSave) {
                showDeck(deckToSelectAfterSave); 
            } else if (state.decks.length > 0) {
                showDeck(state.decks[0].id); 
            } else {
                showWelcomeScreen();
            }
        }

        function editDeck(deckId) {
            const deck = state.decks.find(d => d.id === deckId);
            if (!deck) {
                 console.error("[EditDeck] Cannot edit: Deck not found with ID", deckId);
                 return;
            }
            showDeckModal(true, deck.id); 
        }

        function deleteDeck(deckIdToDelete) {
            console.log(`[DeleteDeck] Called with ID: '${deckIdToDelete}'`);
            // Sandbox: confirm() is ignored and returns false, so we bypass it for testing here.
            // In a real application, you'd want a confirm() or a custom modal.
            // if (!confirm('Möchten Sie dieses Deck wirklich löschen? Alle Karten in diesem Deck werden ebenfalls entfernt.')) {
            //     console.log("[DeleteDeck] Deletion cancelled by user.");
            //     return;
            // }
            console.log("[DeleteDeck] Proceeding with deletion (confirm() is bypassed for sandbox).");


            const initialDeckCount = state.decks.length;
            // console.log("[DeleteDeck] Decks before filter:", JSON.parse(JSON.stringify(state.decks.map(d => ({id: d.id, name: d.name})))));


            let foundAndFiltered = false;
            const newDecksArray = state.decks.filter(deck => {
                const currentDeckIdStr = String(deck.id); 
                const deckIdToDeleteStr = String(deckIdToDelete); 
                const isMatch = currentDeckIdStr === deckIdToDeleteStr;
                // console.log(`[DeleteDeck Filter Loop] Comparing deck.id: '${currentDeckIdStr}' with deckIdToDelete: '${deckIdToDeleteStr}'. Match: ${isMatch}`);
                if (isMatch) {
                    foundAndFiltered = true;
                }
                return !isMatch; 
            });
            
            state.decks = newDecksArray; 
            const finalDeckCount = state.decks.length;
            // console.log("[DeleteDeck] Decks after filter:", JSON.parse(JSON.stringify(state.decks.map(d => ({id: d.id, name: d.name})))));


            if (!foundAndFiltered && initialDeckCount === finalDeckCount) {
                console.warn(`[DeleteDeck] Deck with ID '${String(deckIdToDelete)}' was NOT found or filter failed.`);
            } else if (initialDeckCount > finalDeckCount) {
                 console.log(`[DeleteDeck] Deck '${String(deckIdToDelete)}' successfully filtered. Decks remaining: ${finalDeckCount}.`);
            } else {
                console.warn(`[DeleteDeck] Filter logic issue for ID '${String(deckIdToDelete)}'. Initial: ${initialDeckCount}, Final: ${finalDeckCount}`);
            }
            
            updateStats(); 
            renderDecksList(); 
            
            if (state.currentDeckId === String(deckIdToDelete)) { 
                state.currentDeckId = null;
                if (state.decks.length > 0) {
                    showDeck(state.decks[0].id);
                } else {
                    showWelcomeScreen();
                }
            }
        }

        // --- DATA MANIPULATION (CARDS) ---
        function saveCard() {
            const front = elements.cardFrontInput.value.trim();
            const back = elements.cardBackInput.value.trim();
            
            if (!front || !back) {
                alert("Vorder- und Rückseite der Karte dürfen nicht leer sein."); 
                return;
            }
            
            const deckIndex = state.decks.findIndex(d => d.id === state.currentDeckId);
            if (deckIndex === -1) {
                 alert("Kein Deck ausgewählt, um die Karte zu speichern."); return;
            }
            
            if (state.currentCardId) { 
                const cardIndex = state.decks[deckIndex].cards.findIndex(c => c.id === state.currentCardId);
                if (cardIndex !== -1) {
                    state.decks[deckIndex].cards[cardIndex] = {
                        ...state.decks[deckIndex].cards[cardIndex], 
                        front: front,
                        back: back
                    };
                }
            } else { 
                const newCard = {
                    id: Date.now().toString(),
                    front: front,
                    back: back,
                    difficulty: 'new', 
                    lastReviewed: null,
                    nextReview: null, 
                    reviewCount: 0,
                    createdAt: new Date().toISOString()
                };
                state.decks[deckIndex].cards.push(newCard);
            }
            
            updateStats(); 
            renderCardsList(state.decks[deckIndex].cards); 
            renderDecksList(); 
            hideCardModal();
        }

        function deleteCard(cardIdToDelete) {
            console.log(`[DeleteCard] Called with cardIdToDelete: '${cardIdToDelete}' from deck: '${state.currentDeckId}'`);
            // Sandbox: confirm() is ignored and returns false, so we bypass it for testing here.
            // if (!confirm('Möchten Sie diese Karte wirklich löschen?')) { 
            //     console.log("[DeleteCard] Card deletion cancelled by user.");
            //     return;
            // }
            console.log("[DeleteCard] Proceeding with deletion (confirm() is bypassed for sandbox).");


            const deckIndex = state.decks.findIndex(d => d.id === state.currentDeckId);
            if (deckIndex === -1) {
                console.error(`[DeleteCard] Error: Current deck with ID '${state.currentDeckId}' not found.`);
                alert("Fehler: Aktuelles Deck konnte nicht gefunden werden, um die Karte zu löschen.");
                return;
            }
            
            const initialCardCount = state.decks[deckIndex].cards.length;
            const initialCardsInDeck = JSON.parse(JSON.stringify(state.decks[deckIndex].cards)); // For logging
            // console.log(`[DeleteCard] Cards in deck '${state.decks[deckIndex].name}' before filter:`, initialCardsInDeck.map(c => c.id));

            state.decks[deckIndex].cards = state.decks[deckIndex].cards.filter(card => String(card.id) !== String(cardIdToDelete)); 
            const finalCardCount = state.decks[deckIndex].cards.length;
            // console.log(`[DeleteCard] Cards in deck '${state.decks[deckIndex].name}' after filter:`, state.decks[deckIndex].cards.map(c => c.id));


            if (initialCardCount === finalCardCount && initialCardCount > 0) { 
                // Check if the card was actually present before attempting to filter
                const cardWasPresent = initialCardsInDeck.some(c => String(c.id) === String(cardIdToDelete));
                if (cardWasPresent) {
                     console.warn(`[DeleteCard] Card with ID ${String(cardIdToDelete)} was present but filter might have failed or ID mismatch.`);
                } else {
                     console.warn(`[DeleteCard] Card with ID ${String(cardIdToDelete)} was NOT found in the deck initially.`);
                }
            } else if (initialCardCount > finalCardCount) {
                console.log(`[DeleteCard] Card '${String(cardIdToDelete)}' successfully filtered. Cards remaining: ${finalCardCount}`);
            } else if (initialCardCount === 0 && finalCardCount === 0) {
                // No cards to delete, no warning needed
            }
             else {
                console.warn(`[DeleteCard] Filter logic issue or unexpected state for card ID ${String(cardIdToDelete)}`);
            }


            updateStats(); 
            renderCardsList(state.decks[deckIndex].cards); 
            renderDecksList(); 
        }

        function confirmMoveCard() {
            const cardId = state.cardToMoveId;
            const targetDeckId = elements.targetDeckSelect.value;
            const sourceDeckId = state.currentDeckId;

            if (!cardId || !targetDeckId || !sourceDeckId || sourceDeckId === targetDeckId) {
                console.error("Move Card Error: Invalid IDs or source is same as target.");
                hideMoveCardModal();
                return;
            }

            const sourceDeckIndex = state.decks.findIndex(d => d.id === sourceDeckId);
            const targetDeckIndex = state.decks.findIndex(d => d.id === targetDeckId);

            if (sourceDeckIndex === -1 || targetDeckIndex === -1) {
                console.error("Move Card Error: Source or target deck not found.");
                hideMoveCardModal();
                return;
            }

            const cardIndexInSource = state.decks[sourceDeckIndex].cards.findIndex(c => c.id === cardId);
            if (cardIndexInSource === -1) {
                console.error("Move Card Error: Card not found in source deck.");
                hideMoveCardModal();
                return;
            }

            const [cardToMove] = state.decks[sourceDeckIndex].cards.splice(cardIndexInSource, 1);
            state.decks[targetDeckIndex].cards.push(cardToMove);

            updateStats(); 
            renderDecksList(); 
            renderCardsList(state.decks[sourceDeckIndex].cards); 

            hideMoveCardModal();
            console.log(`Card ${cardId} moved from deck ${sourceDeckId} to ${targetDeckId}`);
        }


        // --- STUDY SESSION LOGIC ---
        function shuffleArray(array) {
            let currentIndex = array.length,  randomIndex;
            // While there remain elements to shuffle.
            while (currentIndex !== 0) {
                // Pick a remaining element.
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                // And swap it with the current element.
                [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function startStudySession(mode = 'normal') {
            const deck = state.decks.find(d => d.id === state.currentDeckId);
            if (!deck || deck.cards.length === 0) {
                alert("Dieses Deck enthält keine Karten zum Lernen."); 
                return;
            }
            
            state.studyMode = mode;
            let cardsToStudy = [];
            let modeText = "";

            switch(mode) {
                case 'again':
                    cardsToStudy = deck.cards.filter(card => card.difficulty === 'again');
                    modeText = "Übungsmodus: Nochmal";
                    break;
                case 'hard':
                    cardsToStudy = deck.cards.filter(card => card.difficulty === 'hard');
                    modeText = "Übungsmodus: Schwer";
                    break;
                case 'easy':
                    cardsToStudy = deck.cards.filter(card => card.difficulty === 'easy');
                    modeText = "Übungsmodus: Einfach";
                    break;
                case 'test':
                    cardsToStudy = shuffleArray([...deck.cards]); // Shuffle a copy
                    modeText = "Testmodus (Alle Karten gemischt)";
                    break;
                case 'normal':
                default:
                    cardsToStudy = [...deck.cards];
                    modeText = ""; // No specific indicator for normal mode
                    break;
            }

            if (cardsToStudy.length === 0 && mode !== 'normal' && mode !== 'test') {
                alert(`Keine Karten für den Modus "${getDifficultyText(mode)}" in diesem Deck gefunden.`);
                return;
            }
             if (cardsToStudy.length === 0 && (mode === 'normal' || mode === 'test')) {
                alert("Dieses Deck enthält keine Karten zum Lernen.");
                return;
            }


            state.studyCards = cardsToStudy; 
            state.currentStudyIndex = 0;
            state.isFlipped = false;
            
            elements.studyModeIndicator.textContent = modeText;
            elements.studyModeIndicator.classList.toggle('hidden', modeText === "");


            elements.welcomeScreen.classList.add('hidden');
            elements.deckView.classList.add('hidden');
            elements.studyView.classList.remove('hidden');
            elements.statsView.classList.add('hidden');
            elements.backBtn.classList.remove('hidden'); 
            
            elements.answerButtons.classList.add('hidden');    
            elements.studyComplete.classList.add('hidden');    
            elements.cardContainer.classList.remove('hidden'); 
            
            loadStudyCard();
        }

        function loadStudyCard() {
            if (state.currentStudyIndex >= state.studyCards.length) {
                elements.studyComplete.classList.remove('hidden');
                elements.cardContainer.classList.add('hidden'); 
                elements.answerButtons.classList.add('hidden'); 
                
                const totalCardsInSession = state.studyCards.length;
                if (totalCardsInSession > 0) { 
                    elements.studyProgress.textContent = `100%`;
                    elements.progressBar.style.width = `100%`;
                    elements.cardsRemaining.textContent = `0 Karten übrig`;
                } else { 
                    elements.studyProgress.textContent = `0%`;
                    elements.progressBar.style.width = `0%`;
                    elements.cardsRemaining.textContent = `0 Karten übrig`;
                }
                if (state.studyMode !== 'test') { // Don't count test mode towards daily stats for now
                    updateStudyStats(totalCardsInSession); 
                }
                return;
            }
            
            const card = state.studyCards[state.currentStudyIndex];
            elements.cardFront.textContent = card.front;
            elements.cardBack.textContent = card.back;
            
            elements.cardContainer.classList.remove('flipped'); 
            state.isFlipped = false; 
            elements.answerButtons.classList.add('hidden'); 
            
            const totalCardsInSession = state.studyCards.length; 
            const progressPercentage = Math.floor(((state.currentStudyIndex) / totalCardsInSession) * 100); 
            elements.cardsRemaining.textContent = `${totalCardsInSession - state.currentStudyIndex} Karten übrig`;
            elements.studyProgress.textContent = `${progressPercentage}%`;
            elements.progressBar.style.width = `${progressPercentage}%`;
            
            elements.cardContainer.classList.remove('hidden'); 
        }

        function flipCard() {
            if (state.currentStudyIndex >= state.studyCards.length || elements.studyComplete.classList.contains('hidden') === false) return;
            
            state.isFlipped = !state.isFlipped;
            elements.cardContainer.classList.toggle('flipped', state.isFlipped);
            elements.answerButtons.classList.toggle('hidden', !state.isFlipped);
        }

        function handleAnswer(difficulty) {
            if (state.currentStudyIndex >= state.studyCards.length) return; 
            
            const originalCardId = state.studyCards[state.currentStudyIndex].id;
            const deckIndex = state.decks.findIndex(d => d.id === state.currentDeckId);
            if (deckIndex === -1) return;
            
            const cardIndexInDeck = state.decks[deckIndex].cards.findIndex(c => c.id === originalCardId);
            if (cardIndexInDeck === -1) return;
            
            const cardToUpdate = state.decks[deckIndex].cards[cardIndexInDeck];
            cardToUpdate.difficulty = difficulty;
            cardToUpdate.lastReviewed = new Date().toISOString();
            cardToUpdate.reviewCount = (cardToUpdate.reviewCount || 0) + 1;
            
            let nextReviewDays = 1; 
            if (difficulty === 'easy') {
                nextReviewDays = cardToUpdate.reviewCount > 1 ? cardToUpdate.reviewCount * 2 : 3; 
            } else if (difficulty === 'hard') {
                nextReviewDays = Math.max(1, Math.floor(cardToUpdate.reviewCount / 2)); 
            }
            
            const nextReviewDate = new Date();
            nextReviewDate.setDate(nextReviewDate.getDate() + nextReviewDays);
            cardToUpdate.nextReview = nextReviewDate.toISOString();
            
            saveState(); 
            
            state.currentStudyIndex++;
            loadStudyCard(); 
        }

        function returnToDeck() {
            if (state.currentDeckId) {
                showDeck(state.currentDeckId);
            } else {
                showWelcomeScreen(); 
            }
            state.studyMode = 'normal'; // Reset study mode
            elements.studyModeIndicator.classList.add('hidden');
        }
        
        function handleBackNavigation() {
            if (!elements.studyView.classList.contains('hidden')) { 
                showDeck(state.currentDeckId);
            } else if (!elements.deckView.classList.contains('hidden')) { 
                showWelcomeScreen();
            } else if (!elements.statsView.classList.contains('hidden')) { 
                if (state.currentDeckId && state.decks.find(d => d.id === state.currentDeckId)) {
                    showDeck(state.currentDeckId);
                } else {
                    showWelcomeScreen();
                }
            }
            state.studyMode = 'normal'; // Reset study mode
            elements.studyModeIndicator.classList.add('hidden');
        }


        // --- STATISTICS MANAGEMENT ---
        function updateStats() {
            state.stats.decksCount = state.decks.length;
            state.stats.cardsCount = state.decks.reduce((sum, deck) => sum + deck.cards.length, 0);
            saveState(); 
        }

        function updateStudyStats(count) {
            const today = new Date().toDateString();
            const lastStudyDateString = state.stats.lastStudyDate ? new Date(state.stats.lastStudyDate).toDateString() : null;
            
            if (lastStudyDateString !== today) { 
                state.stats.studiedToday = 0;
            }
            
            state.stats.studiedToday += count;
            state.stats.lastStudyDate = new Date().toISOString();
            
            const dayOfWeek = new Date().getDay(); 
            if (!state.stats.activity || state.stats.activity.length !== 7) {
                state.stats.activity = Array(7).fill(0);
            }
            state.stats.activity[dayOfWeek] = (state.stats.activity[dayOfWeek] || 0) + count;
            
            saveState(); 
        }

        // --- UTILITY FUNCTIONS ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }
        
        function syncData() {
            alert('Daten wurden synchronisiert (simuliert)'); 
        }

        function saveState() {
            try {
                localStorage.setItem('decks', JSON.stringify(state.decks));
                localStorage.setItem('stats', JSON.stringify(state.stats));
            } catch (e) {
                console.error("Error saving state to localStorage:", e);
            }
        }

        function getDifficultyClass(difficulty) {
            switch(difficulty) {
                case 'easy': return 'bg-emerald-100 text-emerald-800';
                case 'hard': return 'bg-amber-100 text-amber-800';
                case 'again': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800'; 
            }
        }

        function getDifficultyText(difficulty) {
            switch(difficulty) {
                case 'easy': return 'Einfach';
                case 'hard': return 'Schwer';
                case 'again': return 'Nochmal';
                default: return 'Neu';
            }
        }

        function escapeHTML(str) {
            if (typeof str !== 'string') return '';
            return str.replace(/[&<>"']/g, function (match) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                }[match];
            });
        }

        // --- START THE APP ---
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
